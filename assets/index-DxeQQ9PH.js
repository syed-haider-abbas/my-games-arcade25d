var be=Object.defineProperty;var _e=(h,e,t)=>e in h?be(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var M=(h,e,t)=>_e(h,typeof e!="symbol"?e+"":e,t);import{c as xe,p as A,j as l,r as W,u as fe,P as re,B as q,V as ke}from"./index-DTA46di8.js";/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const S="w",T="b",y="p",ie="n",J="b",H="r",O="q",C="k",Z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",P=-1,ve={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},x={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},b={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ee={b:[16,32,17,15],w:[-16,-32,-17,-15]},oe={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},we=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ce=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],ye={p:1,n:2,b:4,r:8,q:16,k:32},Ne="pnbrqkPNBRQK",ae=[ie,J,H,O],Se=7,Pe=6,Ee=1,je=0,V={[C]:x.KSIDE_CASTLE,[O]:x.QSIDE_CASTLE},L={w:[{square:b.a1,flag:x.QSIDE_CASTLE},{square:b.h1,flag:x.KSIDE_CASTLE}],b:[{square:b.a8,flag:x.QSIDE_CASTLE},{square:b.h8,flag:x.KSIDE_CASTLE}]},Me={b:Ee,w:Pe},Te=["1-0","0-1","1/2-1/2","*"];function B(h){return h>>4}function G(h){return h&15}function ue(h){return"0123456789".indexOf(h)!==-1}function j(h){const e=G(h),t=B(h);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function U(h){return h===S?T:S}function Ie(h){const e=h.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<i.length;o++){let r=0,a=!1;for(let d=0;d<i[o].length;d++)if(ue(i[o][d])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};r+=parseInt(i[o][d],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[o][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};r+=1,a=!1}if(r!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:r}of n){if(!r.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(r)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(i[0]+i[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Ae(h,e){const t=h.from,s=h.to,i=h.piece;let n=0,o=0,r=0;for(let a=0,d=e.length;a<d;a++){const u=e[a].from,p=e[a].to,c=e[a].piece;i===c&&t!==u&&s===p&&(n++,B(t)===B(u)&&o++,G(t)===G(u)&&r++)}return n>0?o>0&&r>0?j(t):r>0?j(t).charAt(1):j(t).charAt(0):""}function F(h,e,t,s,i,n=void 0,o=x.NORMAL){const r=B(s);if(i===y&&(r===Se||r===je))for(let a=0;a<ae.length;a++){const d=ae[a];h.push({color:e,from:t,to:s,piece:i,captured:n,promotion:d,flags:o|x.PROMOTION})}else h.push({color:e,from:t,to:s,piece:i,captured:n,flags:o})}function le(h){let e=h.charAt(0);return e>="a"&&e<="h"?h.match(/[a-h]\d.*[a-h]\d/)?void 0:y:(e=e.toLowerCase(),e==="o"?C:e)}function te(h){return h.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function se(h){return h.split(" ").slice(0,4).join(" ")}class Q{constructor(e=Z){M(this,"_board",new Array(128));M(this,"_turn",S);M(this,"_header",{});M(this,"_kings",{w:P,b:P});M(this,"_epSquare",-1);M(this,"_halfMoves",0);M(this,"_moveNumber",0);M(this,"_history",[]);M(this,"_comments",{});M(this,"_castling",{w:0,b:0});M(this,"_positionCount",{});this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:P,b:P},this._turn=S,this._castling={w:0,b:0},this._epSquare=P,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const r=["-","-","0","1"];e=i.concat(r.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:r,error:a}=Ie(e);if(!r)throw new Error(a)}const n=i[0];let o=0;this.clear({preserveHeaders:s});for(let r=0;r<n.length;r++){const a=n.charAt(r);if(a==="/")o+=8;else if(ue(a))o+=parseInt(a,10);else{const d=a<"a"?S:T;this._put({type:a.toLowerCase(),color:d},j(o)),o++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=x.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=x.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=x.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=x.QSIDE_CASTLE),this._epSquare=i[3]==="-"?P:b[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var n,o;let e=0,t="";for(let r=b.a8;r<=b.h1;r++){if(this._board[r]){e>0&&(t+=e,e=0);const{color:a,type:d}=this._board[r];t+=a===S?d.toUpperCase():d.toLowerCase()}else e++;r+1&136&&(e>0&&(t+=e),r!==b.h1&&(t+="/"),e=0,r+=8)}let s="";this._castling[S]&x.KSIDE_CASTLE&&(s+="K"),this._castling[S]&x.QSIDE_CASTLE&&(s+="Q"),this._castling[T]&x.KSIDE_CASTLE&&(s+="k"),this._castling[T]&x.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==P){const r=this._epSquare+(this._turn===S?16:-16),a=[r+1,r-1];for(const d of a){if(d&136)continue;const u=this._turn;if(((n=this._board[d])==null?void 0:n.color)===u&&((o=this._board[d])==null?void 0:o.type)===y){this._makeMove({color:u,from:d,to:this._epSquare,piece:y,captured:y,flags:x.EP_CAPTURE});const p=!this._isKingAttacked(u);if(this._undoMove(),p){i=j(this._epSquare);break}}}}return[t,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==Z?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(Z)}get(e){return this._board[b[e]]||!1}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},s){if(Ne.indexOf(e.toLowerCase())===-1||!(s in b))return!1;const i=b[s];if(e==C&&!(this._kings[t]==P||this._kings[t]==i))return!1;const n=this._board[i];return n&&n.type===C&&(this._kings[n.color]=P),this._board[i]={type:e,color:t},e===C&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[b[e]],t&&t.type===C&&(this._kings[t.color]=P),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,i,n,o,r,a,d,u,p,c,m,f;const e=((s=this._board[b.e1])==null?void 0:s.type)===C&&((i=this._board[b.e1])==null?void 0:i.color)===S,t=((n=this._board[b.e8])==null?void 0:n.type)===C&&((o=this._board[b.e8])==null?void 0:o.color)===T;(!e||((r=this._board[b.a1])==null?void 0:r.type)!==H||((a=this._board[b.a1])==null?void 0:a.color)!==S)&&(this._castling.w&=-65),(!e||((d=this._board[b.h1])==null?void 0:d.type)!==H||((u=this._board[b.h1])==null?void 0:u.color)!==S)&&(this._castling.w&=-33),(!t||((p=this._board[b.a8])==null?void 0:p.type)!==H||((c=this._board[b.a8])==null?void 0:c.color)!==T)&&(this._castling.b&=-65),(!t||((m=this._board[b.h8])==null?void 0:m.type)!==H||((f=this._board[b.h8])==null?void 0:f.color)!==T)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,o;if(this._epSquare===P)return;const e=this._epSquare+(this._turn===S?-16:16),t=this._epSquare+(this._turn===S?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((n=this._board[t])==null?void 0:n.color)!==U(this._turn)||((o=this._board[t])==null?void 0:o.type)!==y){this._epSquare=P;return}const i=r=>{var a,d;return!(r&136)&&((a=this._board[r])==null?void 0:a.color)===this._turn&&((d=this._board[r])==null?void 0:d.type)===y};s.some(i)||(this._epSquare=P)}_attacked(e,t){for(let s=b.a8;s<=b.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const i=this._board[s],n=s-t;if(n===0)continue;const o=n+119;if(we[o]&ye[i.type]){if(i.type===y){if(n>0){if(i.color===S)return!0}else if(i.color===T)return!0;continue}if(i.type==="n"||i.type==="k")return!0;const r=Ce[o];let a=s+r,d=!1;for(;a!==t;){if(this._board[a]!=null){d=!0;break}a+=r}if(!d)return!0}}return!1}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(U(e),t)}isAttacked(e,t){return this._attacked(t,b[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let n=b.a8;n<=b.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const o=this._board[n];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===J&&t.push(i),s++)}if(s===2)return!0;if(s===3&&(e[J]===1||e[ie]===1))return!0;if(s===e[J]+2){let n=0;const o=t.length;for(let r=0;r<o;r++)n+=t[r];if(n===0||n===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const i=this._moves({square:t,piece:s});return e?i.map(n=>this._makePretty(n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var m;const i=s?s.toLowerCase():void 0,n=t==null?void 0:t.toLowerCase(),o=[],r=this._turn,a=U(r);let d=b.a8,u=b.h1,p=!1;if(i)if(i in b)d=u=b[i],p=!0;else return[];for(let f=d;f<=u;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===a)continue;const{type:g}=this._board[f];let k;if(g===y){if(n&&n!==g)continue;k=f+ee[r][0],this._board[k]||(F(o,r,f,k,y),k=f+ee[r][1],Me[r]===B(f)&&!this._board[k]&&F(o,r,f,k,y,void 0,x.BIG_PAWN));for(let v=2;v<4;v++)k=f+ee[r][v],!(k&136)&&(((m=this._board[k])==null?void 0:m.color)===a?F(o,r,f,k,y,this._board[k].type,x.CAPTURE):k===this._epSquare&&F(o,r,f,k,y,y,x.EP_CAPTURE))}else{if(n&&n!==g)continue;for(let v=0,I=oe[g].length;v<I;v++){const _=oe[g][v];for(k=f;k+=_,!(k&136);){if(!this._board[k])F(o,r,f,k,g);else{if(this._board[k].color===r)break;F(o,r,f,k,g,this._board[k].type,x.CAPTURE);break}if(g===ie||g===C)break}}}}if((n===void 0||n===C)&&(!p||u===this._kings[r])){if(this._castling[r]&x.KSIDE_CASTLE){const f=this._kings[r],g=f+2;!this._board[f+1]&&!this._board[g]&&!this._attacked(a,this._kings[r])&&!this._attacked(a,f+1)&&!this._attacked(a,g)&&F(o,r,this._kings[r],g,C,void 0,x.KSIDE_CASTLE)}if(this._castling[r]&x.QSIDE_CASTLE){const f=this._kings[r],g=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(a,this._kings[r])&&!this._attacked(a,f-1)&&!this._attacked(a,g)&&F(o,r,this._kings[r],g,C,void 0,x.QSIDE_CASTLE)}}if(!e||this._kings[r]===-1)return o;const c=[];for(let f=0,g=o.length;f<g;f++)this._makeMove(o[f]),this._isKingAttacked(r)||c.push(o[f]),this._undoMove();return c}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(typeof e=="object"){const n=this._moves();for(let o=0,r=n.length;o<r;o++)if(e.from===j(n[o].from)&&e.to===j(n[o].to)&&(!("promotion"in n[o])||e.promotion===n[o].promotion)){s=n[o];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=this._makePretty(s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=U(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&x.EP_CAPTURE&&(this._turn===T?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===C){if(this._kings[t]=e.to,e.flags&x.KSIDE_CASTLE){const i=e.to-1,n=e.to+1;this._board[i]=this._board[n],delete this._board[n]}else if(e.flags&x.QSIDE_CASTLE){const i=e.to+1,n=e.to-2;this._board[i]=this._board[n],delete this._board[n]}this._castling[t]=0}if(this._castling[t]){for(let i=0,n=L[t].length;i<n;i++)if(e.from===L[t][i].square&&this._castling[t]&L[t][i].flag){this._castling[t]^=L[t][i].flag;break}}if(this._castling[s]){for(let i=0,n=L[s].length;i<n;i++)if(e.to===L[s][i].square&&this._castling[s]&L[s][i].flag){this._castling[s]^=L[s][i].flag;break}}e.flags&x.BIG_PAWN?t===T?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=P,e.piece===y?this._halfMoves=0:e.flags&(x.CAPTURE|x.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===T&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=U(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&x.EP_CAPTURE){let n;s===T?n=t.to-16:n=t.to+16,this._board[n]={type:y,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(x.KSIDE_CASTLE|x.QSIDE_CASTLE)){let n,o;t.flags&x.KSIDE_CASTLE?(n=t.to+1,o=t.to-1):(n=t.to-2,o=t.to+1),this._board[n]=this._board[o],delete this._board[o]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let i=!1;for(const c in this._header)s.push("["+c+' "'+this._header[c]+'"]'+e),i=!0;i&&this._history.length&&s.push(e);const n=c=>{const m=this._comments[this.fen()];if(typeof m<"u"){const f=c.length>0?" ":"";c=`${c}${f}{${m}}`}return c},o=[];for(;this._history.length>0;)o.push(this._undoMove());const r=[];let a="";for(o.length===0&&r.push(n(""));o.length>0;){a=n(a);const c=o.pop();if(!c)break;if(!this._history.length&&c.color==="b"){const m=`${this._moveNumber}. ...`;a=a?`${a} ${m}`:m}else c.color==="w"&&(a.length&&r.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(c,this._moves({legal:!0})),this._makeMove(c)}if(a.length&&r.push(n(a)),typeof this._header.Result<"u"&&r.push(this._header.Result),t===0)return s.join("")+r.join(" ");const d=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},u=function(c,m){for(const f of m.split(" "))if(f){if(c+f.length>t){for(;d();)c--;s.push(e),c=0}s.push(f),c+=f.length,s.push(" "),c++}return d()&&c--,c};let p=0;for(let c=0;c<r.length;c++){if(p+r[c].length>t&&r[c].includes("{")){p=u(p,r[c]);continue}p+r[c].length>t&&c!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),p=0):c!==0&&(s.push(" "),p++),s.push(r[c]),p+=r[c].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){function i(_){return _.replace(/\\/g,"\\")}function n(_){const N={},E=_.split(new RegExp(i(s)));let R="",D="";for(let $=0;$<E.length;$++){const z=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;R=E[$].replace(z,"$1"),D=E[$].replace(z,"$2"),R.trim().length>0&&(N[R]=D)}return N}e=e.trim();const r=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),a=r&&r.length>=2?r[1]:"";this.reset();const d=n(a);let u="";for(const _ in d)_.toLowerCase()==="fen"&&(u=d[_]),this.header(_,d[_]);if(!t)u&&this.load(u,{preserveHeaders:!0});else if(d.SetUp==="1"){if(!("FEN"in d))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(d.FEN,{preserveHeaders:!0})}function p(_){return Array.from(_).map(function(N){return N.charCodeAt(0)<128?N.charCodeAt(0).toString(16):encodeURIComponent(N).replace(/%/g,"").toLowerCase()}).join("")}function c(_){return _.length==0?"":decodeURIComponent("%"+(_.match(/.{1,2}/g)||[]).join("%"))}const m=function(_){return _=_.replace(new RegExp(i(s),"g")," "),`{${p(_.slice(1,_.length-1))}}`},f=function(_){if(_.startsWith("{")&&_.endsWith("}"))return c(_.slice(1,_.length-1))};let g=e.replace(a,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(_,N,E){return N!==void 0?m(N):" "+m(`{${E.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const k=/(\([^()]+\))+?/g;for(;k.test(g);)g=g.replace(k,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");let v=g.trim().split(new RegExp(/\s+/));v=v.filter(_=>_!=="");let I="";for(let _=0;_<v.length;_++){const N=f(v[_]);if(N!==void 0){this._comments[this.fen()]=N;continue}const E=this._moveFromSan(v[_],t);if(E==null)if(Te.indexOf(v[_])>-1)I=v[_];else throw new Error(`Invalid move in PGN: ${v[_]}`);else I="",this._makeMove(E),this._incPositionCount(this.fen())}I&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",I)}_moveToSan(e,t){let s="";if(e.flags&x.KSIDE_CASTLE)s="O-O";else if(e.flags&x.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==y){const i=Ae(e,t);s+=e.piece.toUpperCase()+i}e.flags&(x.CAPTURE|x.EP_CAPTURE)&&(e.piece===y&&(s+=j(e.from)[0]),s+="x"),s+=j(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=te(e);let i=le(s),n=this._moves({legal:!0,piece:i});for(let c=0,m=n.length;c<m;c++)if(s===te(this._moveToSan(n[c],n)))return n[c];if(t)return null;let o,r,a,d,u,p=!1;if(r=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),r?(o=r[1],a=r[2],d=r[3],u=r[4],a.length==1&&(p=!0)):(r=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),r&&(o=r[1],a=r[2],d=r[3],u=r[4],a.length==1&&(p=!0))),i=le(s),n=this._moves({legal:!0,piece:o||i}),!d)return null;for(let c=0,m=n.length;c<m;c++)if(a){if((!o||o.toLowerCase()==n[c].piece)&&b[a]==n[c].from&&b[d]==n[c].to&&(!u||u.toLowerCase()==n[c].promotion))return n[c];if(p){const f=j(n[c].from);if((!o||o.toLowerCase()==n[c].piece)&&b[d]==n[c].to&&(a==f[0]||a==f[1])&&(!u||u.toLowerCase()==n[c].promotion))return n[c]}}else if(s===te(this._moveToSan(n[c],n)).replace("x",""))return n[c];return null}ascii(){let e=`   +------------------------+
`;for(let t=b.a8;t<=b.h1;t++){if(G(t)===0&&(e+=" "+"87654321"[B(t)]+" |"),this._board[t]){const s=this._board[t].type,n=this._board[t].color===S?s.toUpperCase():s.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,o=t.length;n<o;n++)this._makeMove(t[n]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:t,piece:s,from:i,to:n,flags:o,captured:r,promotion:a}=e;let d="";for(const m in x)x[m]&o&&(d+=ve[m]);const u=j(i),p=j(n),c={color:t,piece:s,from:u,to:p,san:this._moveToSan(e,this._moves({legal:!0})),flags:d,lan:u+p,before:this.fen(),after:""};return this._makeMove(e),c.after=this.fen(),this._undoMove(),r&&(c.captured=r),a&&(c.promotion=a,c.lan+=a),c}turn(){return this._turn}board(){const e=[];let t=[];for(let s=b.a8;s<=b.h1;s++)this._board[s]==null?t.push(null):t.push({square:j(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in b){const t=b[e];return(B(t)+G(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(this._makePretty(i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=se(e);return this._positionCount[t]||0}_incPositionCount(e){const t=se(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=se(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[C,O])t[i]!==void 0&&(t[i]?this._castling[e]|=V[i]:this._castling[e]&=~V[i]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[C]===void 0||t[C]===s[C])&&(t[O]===void 0||t[O]===s[O])}getCastlingRights(e){return{[C]:(this._castling[e]&V[C])!==0,[O]:(this._castling[e]&V[O])!==0}}moveNumber(){return this._moveNumber}}const me=[{id:1,name:"Pawn Parade",description:"March your pawns forward! But watch out for the Careful Turtle.",fen:"4k3/pppppppp/8/8/8/8/PPPPPPPP/4K3 w - - 0 1",aiPersonality:"random",opponentName:"Careful Turtle",colorClass:"bg-emerald-400",icon:"ðŸ¢"},{id:2,name:"Tower Power",description:"Rooks move fast and straight. Can you beat the Brave Lion?",fen:"r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1",aiPersonality:"aggressive",opponentName:"Brave Lion",colorClass:"bg-orange-400",icon:"ðŸ¦"},{id:3,name:"Tricky Knights",description:"Knights jump over other pieces! The Monkey loves to jump around.",fen:"n3k1n1/pppppppp/8/8/8/8/PPPPPPPP/N3K1N1 w - - 0 1",aiPersonality:"random",opponentName:"Tricky Monkey",colorClass:"bg-yellow-400",icon:"ðŸ’"},{id:4,name:"Royal Kingdom",description:"The full army has arrived. Outsmart the Fox to win!",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Clever Fox",colorClass:"bg-indigo-400",icon:"ðŸ¦Š"}],pe=[{id:100,name:"Standard Chess",description:"Full game against the computer.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Robot",colorClass:"bg-blue-500",icon:"ðŸ¤–",isPvp:!1},{id:101,name:"Player vs Player",description:"Challenge a friend on the same screen.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"random",opponentName:"Player 2",colorClass:"bg-rose-500",icon:"ðŸ‘¥",isPvp:!0}],K=[...me,...pe],ge={containerBg:"bg-white dark:bg-slate-800",borderColor:"border-slate-200 dark:border-slate-900",gridBg:"bg-slate-100 dark:bg-slate-950",lightSquare:"bg-[#F8FAFC] dark:bg-slate-700",darkSquare:"bg-[#CFE2FF] dark:bg-slate-600",labelLight:"text-slate-400 dark:text-slate-500",labelDark:"text-blue-400/50 dark:text-slate-500",highlight:"bg-indigo-500/20",lastMove:"bg-amber-400/20",check:"bg-rose-500/30",validMoveDot:"bg-indigo-500/30",captureRing:"border-indigo-500/40"},X={WHITE:{stroke:"#92400E",text:"text-amber-400"},BLACK:{stroke:"#312E81",text:"text-indigo-400"}},Y={p:1,n:3,b:3,r:5,q:9,k:0},Re=(h,e)=>{const s=new Q(h).moves({verbose:!0});if(s.length===0)return null;if(e==="random"&&Math.random()>.3)return s[Math.floor(Math.random()*s.length)];if(e==="aggressive"){s.sort((n,o)=>{const r=n.captured?Y[n.captured]:0;return(o.captured?Y[o.captured]:0)-r});const i=s[0];if(i.captured)return i}if(e==="defensive"){const i=s.filter(n=>{const o=new Q(h);return o.move(n),!o.moves({verbose:!0}).some(d=>d.to===n.to)});if(i.length>0){i.sort((o,r)=>{const a=o.captured?Y[o.captured]:0;return(r.captured?Y[r.captured]:0)-a});const n=i.slice(0,3);return n[Math.floor(Math.random()*n.length)]}}return s[Math.floor(Math.random()*s.length)]};let w=null;const ne=xe((h,e)=>({game:new Q,fen:new Q().fen(),levelId:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Select a level to start!",showFeedback:!1,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[],startLevel:t=>{const s=K.find(n=>n.id===t);if(!s)return;A("start");const i=new Q(s.fen);h({game:i,fen:i.fen(),levelId:t,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:s.id>=100?"":s.isPvp?"White's Turn":"Your turn! Tap a white piece.",showFeedback:s.id<100,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[i.fen()]}),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)},selectSquare:t=>{const{game:s,isPlayerTurn:i,isGameOver:n,selectedSquare:o,levelId:r}=e();if(!i||n)return;const a=K.find(m=>m.id===r),d=a==null?void 0:a.isPvp,u=s.turn();if(o===t){h({selectedSquare:null,possibleMoves:[],promotionMoves:[]});return}const p=s.get(t);let c=!1;if(p&&(d?c=p.color===u:c=p.color==="w"&&u==="w"),c){const m=s.moves({square:t,verbose:!0}),f=m.filter(k=>k.promotion).map(k=>k.to);A("click");const g=f.length>0;h({selectedSquare:t,possibleMoves:m.map(k=>k.to),promotionMoves:f,feedback:g?"Promote your pawn!":e().feedback,showFeedback:!!g}),g&&w&&clearTimeout(w)}else o&&e().makeMove(t)},makeMove:t=>{const{game:s,selectedSquare:i,levelId:n}=e();if(!i)return;const o=K.find(d=>d.id===n),r=o==null?void 0:o.isPvp,a=((o==null?void 0:o.id)||0)>=100;try{const u=s.moves({verbose:!0}).find(c=>c.from===i&&c.to===t&&(!c.promotion||c.promotion==="q"));if(!u){h({selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Invalid Move",showFeedback:!0}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),1500);return}const p=s.move(u.san);if(p){p.captured?A("drop"):A("tap");const c=[...e().history,s.fen()];let m="";if(s.isCheck()?m="Check!":p.promotion?m="Pawn Promoted! ðŸ‘‘":p.captured&&!a?m="Captured!":a||r||(m="Nice move!"),h({fen:s.fen(),selectedSquare:null,possibleMoves:[],promotionMoves:[],lastMove:{from:p.from,to:p.to},history:c,feedback:m,showFeedback:!!m}),w&&clearTimeout(w),m&&(w=setTimeout(()=>e().hideFeedback(),2e3)),s.isGameOver()){const f=s.isDraw();h({isGameOver:!0,winner:f?"draw":"player",feedback:f?"It's a tie!":r?p.color==="w"?"White Wins!":"Black Wins!":"You won!",showFeedback:!0}),f||A("win")}else r?h({isPlayerTurn:!0}):(h({isPlayerTurn:!1}),setTimeout(()=>e().botMove(),1e3))}}catch(d){console.error(d),h({selectedSquare:null,possibleMoves:[],promotionMoves:[]})}},botMove:()=>{const{game:t,levelId:s}=e();if(t.isGameOver())return;const i=K.find(a=>a.id===s);if(i!=null&&i.isPvp)return;const n=((i==null?void 0:i.id)||0)>=100,o=(i==null?void 0:i.aiPersonality)||"random",r=Re(t.fen(),o);if(r){t.move(r),r.captured?A("drop"):A("tap");const a=[...e().history,t.fen()];let d="";if(t.isCheck()?d="Watch out! Check!":n||(d=`${(i==null?void 0:i.opponentName)||"Opponent"} moved.`),h({fen:t.fen(),isPlayerTurn:!0,lastMove:{from:r.from,to:r.to},history:a,feedback:d,showFeedback:!!d}),w&&clearTimeout(w),d&&(w=setTimeout(()=>e().hideFeedback(),2e3)),t.isGameOver()){const u=t.isDraw();h({isGameOver:!0,winner:u?"draw":"bot",feedback:u?"It's a tie!":"Oh no! Try again?",showFeedback:!0})}}},giveHint:()=>{const{game:t,isPlayerTurn:s,isGameOver:i,levelId:n}=e();if(!s||i)return;const o=K.find(a=>a.id===n);if(((o==null?void 0:o.id)||0)>=100)return;const r=t.moves({verbose:!0});if(r.length>0){const a=r.filter(u=>u.captured||u.promotion),d=a.length>0?a[Math.floor(Math.random()*a.length)]:r[Math.floor(Math.random()*r.length)];h({selectedSquare:d.from,possibleMoves:r.filter(u=>u.from===d.from).map(u=>u.to),promotionMoves:[],feedback:"Try this move!",showFeedback:!0}),A("click"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)}},hideFeedback:()=>{h({showFeedback:!1})},undo:()=>{const{history:t,levelId:s}=e();if(t.length<=1)return;const i=K.find(d=>d.id===s),n=i!=null&&i.isPvp?1:2;if(t.length<=n){e().startLevel(s);return}const o=t.slice(0,t.length-n),r=o[o.length-1],a=new Q(r);h({game:a,fen:r,history:o,isPlayerTurn:!0,isGameOver:!1,winner:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Time travel!",showFeedback:((i==null?void 0:i.id)||0)<100}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),2e3)},exitLevel:()=>{h({levelId:null,showFeedback:!1}),w&&clearTimeout(w)}})),ce=({level:h,onClick:e})=>l.jsxs("button",{onClick:()=>e(h.id),className:`
        group relative
        flex flex-col items-center text-center
        p-6 rounded-3xl
        bg-white dark:bg-slate-800
        border-2 border-slate-200 dark:border-slate-700
        shadow-xl hover:shadow-2xl hover:-translate-y-1 hover:border-indigo-400
        transition-all duration-300
        h-full
        `,children:[l.jsx("div",{className:`
        w-20 h-20 rounded-full flex items-center justify-center text-5xl mb-4
        ${h.colorClass} text-white shadow-lg group-hover:scale-110 transition-transform
        `,children:h.icon}),l.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:h.name}),l.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed mb-4",children:h.description}),l.jsx("div",{className:"mt-auto",children:l.jsxs("span",{className:"inline-block px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs font-bold text-slate-600 dark:text-slate-300 uppercase tracking-wider",children:["VS ",h.opponentName]})})]}),qe=()=>{const{startLevel:h}=ne();return l.jsx("div",{className:"w-full h-full overflow-y-auto p-4 md:p-8 animate-fade-in pb-24",children:l.jsxs("div",{className:"max-w-4xl mx-auto space-y-12 text-center",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"inline-block text-6xl mb-2 animate-bounce",children:"â™Ÿï¸"}),l.jsx("h1",{className:"text-4xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight",children:"Chess Kiddo"}),l.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-400 font-medium",children:"Choose a mode to play!"})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),l.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Quick Play"}),l.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:pe.map(e=>l.jsx(ce,{level:e,onClick:h},e.id))})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex items-center gap-4",children:[l.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),l.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Learning Missions"}),l.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:me.map(e=>l.jsx(ce,{level:e,onClick:h},e.id))})]})]})})},Le={p:"â™Ÿ",n:"â™ž",b:"â™",r:"â™œ",q:"â™›",k:"â™š"},Fe=W.memo(({type:h,color:e})=>{const t=Le[h],i=e==="w"?X.WHITE:X.BLACK,n=i.stroke,o=`
    0.02em 0.02em 0 ${n},
    -0.02em -0.02em 0 ${n},
    0.02em -0.02em 0 ${n},
    -0.02em 0.02em 0 ${n},
    0 0.04em 0.1em rgba(0,0,0,0.2)
  `;return l.jsx("div",{className:"relative w-full h-full flex items-center justify-center pointer-events-none select-none overflow-visible",children:l.jsx("div",{className:`
            leading-none 
            transition-transform duration-200
            ${i.text}
            pb-[10%]
            will-change-transform
            flex items-center justify-center
        `,style:{fontSize:"75cqmin",textShadow:o,filter:"drop-shadow(0 4px 4px rgba(0,0,0,0.1))"},children:l.jsx("span",{children:t})})})}),Oe=W.memo(({square:h,piece:e,bgClass:t,labelColorClass:s,isSelected:i,isPossibleMove:n,isPromotionMove:o,isLastMove:r,isCheck:a,onClick:d})=>{const u=ge;return l.jsx("div",{onClick:d,className:"relative w-full h-full p-0.5 md:p-1",style:{containerType:"size"},children:l.jsxs("div",{className:`
                relative w-full h-full flex items-center justify-center
                rounded-md md:rounded-lg
                ${t}
                ${n||o?"cursor-pointer":""}
                transition-all duration-200
                shadow-sm
                border-b-2 border-black/5 dark:border-white/5
            `,children:[i&&l.jsx("div",{className:`absolute inset-0 ${u.highlight} z-0 rounded-md md:rounded-lg ring-inset ring-4 ring-indigo-500/50`}),r&&!i&&l.jsx("div",{className:`absolute inset-0 ${u.lastMove} z-0 rounded-md md:rounded-lg`}),a&&l.jsx("div",{className:`absolute inset-0 ${u.check} z-0 animate-pulse rounded-md md:rounded-lg ring-inset ring-4 ring-rose-500/50`}),(h.includes("1")||h.includes("a"))&&l.jsx("span",{className:`absolute bottom-0.5 left-1 text-[7px] md:text-[9px] font-black select-none z-0 ${s} opacity-80`,children:h.toUpperCase()}),n&&!e&&!o&&l.jsx("div",{className:`absolute w-[20%] h-[20%] ${u.validMoveDot} rounded-full z-10 border border-indigo-500/20`}),n&&e&&!o&&l.jsx("div",{className:`absolute inset-[8%] border-4 border-dashed ${u.captureRing} rounded-full z-10 animate-spin-slow`,style:{animationDuration:"10s"}}),e&&l.jsx("div",{className:"relative z-10 w-full h-full flex items-center justify-center transform transition-transform group-active:scale-90",children:l.jsx(Fe,{type:e.type,color:e.color})})]})})}),Ke=()=>{const{game:h,fen:e,selectedSquare:t,possibleMoves:s,promotionMoves:i,lastMove:n,selectSquare:o}=ne(),{enableTilt:r}=fe(),a=ge,d=W.useMemo(()=>h.board(),[e,h]),u=["a","b","c","d","e","f","g","h"],p=[8,7,6,5,4,3,2,1],c=W.useMemo(()=>({width:"100%",maxWidth:"100%",aspectRatio:"1/1",transform:r?"rotateX(5deg)":"none"}),[r]);return l.jsx("div",{className:"relative w-full h-full flex items-center justify-center perspective-1000 p-2 md:p-6",children:l.jsx("div",{className:`
            relative
            w-full h-full
            rounded-2xl md:rounded-[2rem]
            p-2 md:p-3
            border-2
            transition-all duration-500 ease-out
            will-change-transform
            ${a.containerBg}
            ${a.borderColor}
            shadow-[0_10px_30px_rgba(0,0,0,0.15),_0_8px_0_#cbd5e1]
            dark:shadow-[0_10px_40px_rgba(0,0,0,0.5),_0_8px_0_#0f172a]
          `,style:c,children:l.jsx("div",{className:`
            relative
            w-full h-full
            ${a.gridBg}
            rounded-xl md:rounded-[1.5rem]
            overflow-hidden
            shadow-[inset_0_4px_12px_rgba(0,0,0,0.15)]
            border-4 border-slate-200 dark:border-slate-900
          `,children:l.jsx("div",{className:`
               w-full h-full 
               grid grid-cols-8 grid-rows-8 
               p-0.5 md:p-1
             `,children:d.map((m,f)=>m.map((g,k)=>{const v=`${u[k]}${p[f]}`,I=(f+k)%2===0,_=t===v,N=s.includes(v),E=i==null?void 0:i.includes(v),R=n?n.from===v||n.to===v:!1,D=(g==null?void 0:g.type)==="k"&&(g==null?void 0:g.color)===h.turn()&&h.isCheck(),$=I?a.lightSquare:a.darkSquare,z=I?a.labelLight:a.labelDark;return l.jsx(Oe,{square:v,piece:g,bgClass:$,labelColorClass:z,isSelected:_,isPossibleMove:N,isPromotionMove:E,isLastMove:R,isCheck:D,onClick:()=>o(v)},v)}))})})})})},de=W.memo(({name:h,isWhite:e,isActive:t,alignment:s})=>{const i=s==="right",n=e?X.WHITE:X.BLACK;return l.jsxs("div",{className:`
        flex items-center gap-2 md:gap-4 transition-all duration-500
        ${t?"opacity-100 scale-100":"opacity-60 scale-95 grayscale-[0.3]"}
        ${i?"flex-row-reverse text-right":"flex-row text-left"}
    `,children:[l.jsxs("div",{className:`
          relative w-10 h-10 md:w-14 md:h-14 rounded-xl md:rounded-2xl flex items-center justify-center text-2xl md:text-4xl shadow-lg border-2
          ${e?"bg-white border-amber-400":"bg-white border-indigo-400"}
          ${t?"ring-2 ring-indigo-500/20 ring-offset-2 dark:ring-offset-slate-950":""}
          transition-all duration-300
       `,children:[l.jsx("span",{className:`${n.text} drop-shadow-sm font-black transform ${t?"scale-110":"scale-100"}`,style:{textShadow:`1px 1px 0 ${n.stroke}`,filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.1))"},children:e?"â™”":"â™š"}),t&&l.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-emerald-500 border-2 border-white dark:border-slate-800 rounded-full animate-ping"})]}),l.jsxs("div",{className:"flex flex-col justify-center min-w-0 max-w-[100px] md:max-w-[140px]",children:[l.jsx("span",{className:"font-bold text-slate-900 dark:text-white text-xs md:text-lg tracking-tight leading-none truncate",children:h}),l.jsx("div",{className:"flex items-center gap-1 mt-1",children:l.jsx("span",{className:`
                text-[9px] md:text-[10px] font-black uppercase tracking-wider px-1.5 py-0.5 rounded-full
                ${t?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300 animate-pulse":"bg-slate-200 text-slate-500 dark:bg-slate-800 dark:text-slate-500"}
            `,children:t?"Turn":"Wait"})})]})]})}),he=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),Be=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),De=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),$e=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),Qe=()=>l.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),We=()=>{const{setView:h,players:e}=fe(),{levelId:t,game:s,feedback:i,showFeedback:n,history:o,undo:r,giveHint:a,exitLevel:d,startLevel:u,isGameOver:p,winner:c}=ne(),m=K.find(D=>D.id===t),f=((m==null?void 0:m.id)||0)>=100,g=m==null?void 0:m.isPvp,k=!f&&!p,v=g?e[re.ONE].name:"You",I=g?e[re.TWO].name:(m==null?void 0:m.opponentName)||"Opponent",_=s.turn(),N=()=>{d(),h(ke.HOME)},E=()=>{d()},R=()=>{t&&u(t)};return!t||!m?l.jsxs("div",{className:"flex flex-col h-screen w-full bg-slate-100 dark:bg-slate-900 relative",children:[l.jsx("header",{className:"shrink-0 h-16 md:h-20 px-6 flex items-center justify-between z-10",children:l.jsx(q,{variant:"icon",size:"sm",onClick:N,title:"Return to Menu",children:l.jsx(he,{})})}),l.jsx(qe,{})]}):l.jsxs("div",{className:"flex flex-col h-screen w-full bg-slate-100 dark:bg-slate-950 transition-colors duration-500 overflow-hidden relative",children:[l.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[l.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-400/5 rounded-full blur-[80px]"}),l.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-400/5 rounded-full blur-[80px]"})]}),l.jsxs("header",{className:"shrink-0 h-16 md:h-20 px-3 md:px-8 flex items-center justify-between z-30 bg-white/60 dark:bg-slate-900/40 backdrop-blur-md border-b border-slate-200 dark:border-white/5 relative shadow-sm transition-colors duration-300",children:[l.jsx("div",{className:"flex-1 flex justify-start min-w-0",children:l.jsx(de,{name:v,isWhite:!0,isActive:_==="w"&&!p,alignment:"left"})}),l.jsxs("div",{className:"shrink-0 flex items-center gap-1 md:gap-2 mx-2",children:[l.jsx(q,{variant:"icon",size:"sm",onClick:E,title:"Level Select",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:l.jsx(Be,{})}),l.jsx(q,{variant:"icon",size:"sm",onClick:R,title:"Restart",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:l.jsx(Qe,{})}),k&&l.jsx(q,{variant:"icon",size:"sm",onClick:a,title:"Get a Hint",className:"w-9 h-9 md:w-11 md:h-11 p-2 !bg-indigo-50 !text-indigo-600 dark:!bg-indigo-900/30 dark:!text-indigo-300 border-indigo-100 dark:border-indigo-800 shadow-inner",children:l.jsx($e,{})}),l.jsx(q,{variant:"icon",size:"sm",onClick:r,disabled:o.length<=1||p,title:"Undo Move",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:l.jsx(De,{})}),l.jsx(q,{variant:"icon",size:"sm",onClick:N,title:"Home",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:l.jsx(he,{})})]}),l.jsx("div",{className:"flex-1 flex justify-end min-w-0",children:l.jsx(de,{name:I,isWhite:!1,isActive:_==="b"&&!p,alignment:"right"})})]}),l.jsxs("main",{className:"flex-1 w-full h-full flex flex-col items-center justify-center p-2 relative z-10 perspective-1000 overflow-hidden",children:[l.jsxs("div",{className:"relative aspect-square portrait:w-full portrait:max-h-full landscape:h-full landscape:max-w-full flex items-center justify-center animate-fade-in",children:[l.jsx(Ke,{}),n&&i&&l.jsx("div",{className:"absolute top-4 pointer-events-none transition-all duration-300 transform z-20",children:l.jsxs("div",{className:"bg-white/95 dark:bg-slate-800/95 rounded-2xl px-6 py-2 shadow-xl border-b-4 border-indigo-500 flex items-center gap-3 animate-bounce-in",children:[l.jsx("span",{className:"text-2xl",children:m.icon}),l.jsx("p",{className:"text-slate-900 dark:text-white font-black text-sm md:text-lg tracking-tight uppercase",children:i})]})})]}),p&&l.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in",children:l.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 md:p-12 rounded-[3rem] text-center shadow-2xl max-w-md w-full border-b-8 border-indigo-500",children:[l.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-6xl mb-8 shadow-inner rotate-3",children:c==="player"?"ðŸ‘‘":c==="draw"?"ðŸ¤":"ðŸ’«"}),l.jsx("h2",{className:"text-4xl font-black text-slate-900 dark:text-white mb-4 tracking-tight",children:c==="player"?g?s.turn()==="b"?"White Wins!":"Black Wins!":"Victory!":c==="draw"?"Match Draw":"Nice Effort!"}),l.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-10 font-bold text-lg leading-relaxed",children:c==="player"?"You played like a champion!":"That was a close one. Ready to try again?"}),l.jsxs("div",{className:"flex flex-col gap-4",children:[l.jsx(q,{onClick:R,size:"lg",className:"w-full !rounded-2xl !py-5 !text-2xl shadow-xl shadow-indigo-500/30",children:"Play Again"}),l.jsx(q,{onClick:E,variant:"secondary",className:"w-full !rounded-2xl !py-4 font-bold !bg-slate-100 dark:!bg-slate-700 text-slate-600 dark:text-slate-300 border-none",children:"Exit Game"})]})]})})]})]})};export{We as ChessKiddoGame};
