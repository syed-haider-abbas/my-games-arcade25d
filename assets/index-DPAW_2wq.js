var ke=Object.defineProperty;var we=(c,e,t)=>e in c?ke(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var M=(c,e,t)=>we(c,typeof e!="symbol"?e+"":e,t);import{f as T,c as Se,p as A,r as G,j as a,B as R,u as be,P as de,V as Ne}from"./index-C6bnjAcI.js";import{H as ye,G as ce}from"./GameConfigFooter-DbX1rpMV.js";/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const C="w",I="b",y="p",re="n",Z="b",z="r",K="q",S="k",se="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",P=-1,Ce={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},_={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},b={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ie={b:[16,32,17,15],w:[-16,-32,-17,-15]},he={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Pe=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],je=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ee={p:1,n:2,b:4,r:8,q:16,k:32},Te="pnbrqkPNBRQK",fe=[re,Z,z,K],Me=7,Ie=6,Le=1,Ae=0,J={[S]:_.KSIDE_CASTLE,[K]:_.QSIDE_CASTLE},O={w:[{square:b.a1,flag:_.QSIDE_CASTLE},{square:b.h1,flag:_.KSIDE_CASTLE}],b:[{square:b.a8,flag:_.QSIDE_CASTLE},{square:b.h8,flag:_.KSIDE_CASTLE}]},Re={b:Le,w:Ie},qe=["1-0","0-1","1/2-1/2","*"];function D(c){return c>>4}function V(c){return c&15}function xe(c){return"0123456789".indexOf(c)!==-1}function E(c){const e=V(c),t=D(c);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function U(c){return c===C?I:C}function Oe(c){const e=c.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let r=0;r<i.length;r++){let n=0,l=!1;for(let h=0;h<i[r].length;h++)if(xe(i[r][h])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};n+=parseInt(i[r][h],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[r][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};n+=1,l=!1}if(n!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:r,regex:n}of o){if(!n.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${r} king`};if((e[0].match(n)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${r} kings`}}return Array.from(i[0]+i[7]).some(r=>r.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Fe(c,e){const t=c.from,s=c.to,i=c.piece;let o=0,r=0,n=0;for(let l=0,h=e.length;l<h;l++){const f=e[l].from,p=e[l].to,d=e[l].piece;i===d&&t!==f&&s===p&&(o++,D(t)===D(f)&&r++,V(t)===V(f)&&n++)}return o>0?r>0&&n>0?E(t):n>0?E(t).charAt(1):E(t).charAt(0):""}function F(c,e,t,s,i,o=void 0,r=_.NORMAL){const n=D(s);if(i===y&&(n===Me||n===Ae))for(let l=0;l<fe.length;l++){const h=fe[l];c.push({color:e,from:t,to:s,piece:i,captured:o,promotion:h,flags:r|_.PROMOTION})}else c.push({color:e,from:t,to:s,piece:i,captured:o,flags:r})}function ue(c){let e=c.charAt(0);return e>="a"&&e<="h"?c.match(/[a-h]\d.*[a-h]\d/)?void 0:y:(e=e.toLowerCase(),e==="o"?S:e)}function oe(c){return c.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ne(c){return c.split(" ").slice(0,4).join(" ")}class ${constructor(e=se){M(this,"_board",new Array(128));M(this,"_turn",C);M(this,"_header",{});M(this,"_kings",{w:P,b:P});M(this,"_epSquare",-1);M(this,"_halfMoves",0);M(this,"_moveNumber",0);M(this,"_history",[]);M(this,"_comments",{});M(this,"_castling",{w:0,b:0});M(this,"_positionCount",{});this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:P,b:P},this._turn=C,this._castling={w:0,b:0},this._epSquare=P,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const n=["-","-","0","1"];e=i.concat(n.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:n,error:l}=Oe(e);if(!n)throw new Error(l)}const o=i[0];let r=0;this.clear({preserveHeaders:s});for(let n=0;n<o.length;n++){const l=o.charAt(n);if(l==="/")r+=8;else if(xe(l))r+=parseInt(l,10);else{const h=l<"a"?C:I;this._put({type:l.toLowerCase(),color:h},E(r)),r++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=_.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=_.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=_.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=_.QSIDE_CASTLE),this._epSquare=i[3]==="-"?P:b[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var o,r;let e=0,t="";for(let n=b.a8;n<=b.h1;n++){if(this._board[n]){e>0&&(t+=e,e=0);const{color:l,type:h}=this._board[n];t+=l===C?h.toUpperCase():h.toLowerCase()}else e++;n+1&136&&(e>0&&(t+=e),n!==b.h1&&(t+="/"),e=0,n+=8)}let s="";this._castling[C]&_.KSIDE_CASTLE&&(s+="K"),this._castling[C]&_.QSIDE_CASTLE&&(s+="Q"),this._castling[I]&_.KSIDE_CASTLE&&(s+="k"),this._castling[I]&_.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==P){const n=this._epSquare+(this._turn===C?16:-16),l=[n+1,n-1];for(const h of l){if(h&136)continue;const f=this._turn;if(((o=this._board[h])==null?void 0:o.color)===f&&((r=this._board[h])==null?void 0:r.type)===y){this._makeMove({color:f,from:h,to:this._epSquare,piece:y,captured:y,flags:_.EP_CAPTURE});const p=!this._isKingAttacked(f);if(this._undoMove(),p){i=E(this._epSquare);break}}}}return[t,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==se?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(se)}get(e){return this._board[b[e]]||!1}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},s){if(Te.indexOf(e.toLowerCase())===-1||!(s in b))return!1;const i=b[s];if(e==S&&!(this._kings[t]==P||this._kings[t]==i))return!1;const o=this._board[i];return o&&o.type===S&&(this._kings[o.color]=P),this._board[i]={type:e,color:t},e===S&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[b[e]],t&&t.type===S&&(this._kings[t.color]=P),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,i,o,r,n,l,h,f,p,d,m,u;const e=((s=this._board[b.e1])==null?void 0:s.type)===S&&((i=this._board[b.e1])==null?void 0:i.color)===C,t=((o=this._board[b.e8])==null?void 0:o.type)===S&&((r=this._board[b.e8])==null?void 0:r.color)===I;(!e||((n=this._board[b.a1])==null?void 0:n.type)!==z||((l=this._board[b.a1])==null?void 0:l.color)!==C)&&(this._castling.w&=-65),(!e||((h=this._board[b.h1])==null?void 0:h.type)!==z||((f=this._board[b.h1])==null?void 0:f.color)!==C)&&(this._castling.w&=-33),(!t||((p=this._board[b.a8])==null?void 0:p.type)!==z||((d=this._board[b.a8])==null?void 0:d.color)!==I)&&(this._castling.b&=-65),(!t||((m=this._board[b.h8])==null?void 0:m.type)!==z||((u=this._board[b.h8])==null?void 0:u.color)!==I)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var o,r;if(this._epSquare===P)return;const e=this._epSquare+(this._turn===C?-16:16),t=this._epSquare+(this._turn===C?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((o=this._board[t])==null?void 0:o.color)!==U(this._turn)||((r=this._board[t])==null?void 0:r.type)!==y){this._epSquare=P;return}const i=n=>{var l,h;return!(n&136)&&((l=this._board[n])==null?void 0:l.color)===this._turn&&((h=this._board[n])==null?void 0:h.type)===y};s.some(i)||(this._epSquare=P)}_attacked(e,t){for(let s=b.a8;s<=b.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const i=this._board[s],o=s-t;if(o===0)continue;const r=o+119;if(Pe[r]&Ee[i.type]){if(i.type===y){if(o>0){if(i.color===C)return!0}else if(i.color===I)return!0;continue}if(i.type==="n"||i.type==="k")return!0;const n=je[r];let l=s+n,h=!1;for(;l!==t;){if(this._board[l]!=null){h=!0;break}l+=n}if(!h)return!0}}return!1}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(U(e),t)}isAttacked(e,t){return this._attacked(t,b[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let o=b.a8;o<=b.h1;o++){if(i=(i+1)%2,o&136){o+=7;continue}const r=this._board[o];r&&(e[r.type]=r.type in e?e[r.type]+1:1,r.type===Z&&t.push(i),s++)}if(s===2)return!0;if(s===3&&(e[Z]===1||e[re]===1))return!0;if(s===e[Z]+2){let o=0;const r=t.length;for(let n=0;n<r;n++)o+=t[n];if(o===0||o===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const i=this._moves({square:t,piece:s});return e?i.map(o=>this._makePretty(o)):i.map(o=>this._moveToSan(o,i))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var m;const i=s?s.toLowerCase():void 0,o=t==null?void 0:t.toLowerCase(),r=[],n=this._turn,l=U(n);let h=b.a8,f=b.h1,p=!1;if(i)if(i in b)h=f=b[i],p=!0;else return[];for(let u=h;u<=f;u++){if(u&136){u+=7;continue}if(!this._board[u]||this._board[u].color===l)continue;const{type:g}=this._board[u];let v;if(g===y){if(o&&o!==g)continue;v=u+ie[n][0],this._board[v]||(F(r,n,u,v,y),v=u+ie[n][1],Re[n]===D(u)&&!this._board[v]&&F(r,n,u,v,y,void 0,_.BIG_PAWN));for(let k=2;k<4;k++)v=u+ie[n][k],!(v&136)&&(((m=this._board[v])==null?void 0:m.color)===l?F(r,n,u,v,y,this._board[v].type,_.CAPTURE):v===this._epSquare&&F(r,n,u,v,y,y,_.EP_CAPTURE))}else{if(o&&o!==g)continue;for(let k=0,L=he[g].length;k<L;k++){const x=he[g][k];for(v=u;v+=x,!(v&136);){if(!this._board[v])F(r,n,u,v,g);else{if(this._board[v].color===n)break;F(r,n,u,v,g,this._board[v].type,_.CAPTURE);break}if(g===re||g===S)break}}}}if((o===void 0||o===S)&&(!p||f===this._kings[n])){if(this._castling[n]&_.KSIDE_CASTLE){const u=this._kings[n],g=u+2;!this._board[u+1]&&!this._board[g]&&!this._attacked(l,this._kings[n])&&!this._attacked(l,u+1)&&!this._attacked(l,g)&&F(r,n,this._kings[n],g,S,void 0,_.KSIDE_CASTLE)}if(this._castling[n]&_.QSIDE_CASTLE){const u=this._kings[n],g=u-2;!this._board[u-1]&&!this._board[u-2]&&!this._board[u-3]&&!this._attacked(l,this._kings[n])&&!this._attacked(l,u-1)&&!this._attacked(l,g)&&F(r,n,this._kings[n],g,S,void 0,_.QSIDE_CASTLE)}}if(!e||this._kings[n]===-1)return r;const d=[];for(let u=0,g=r.length;u<g;u++)this._makeMove(r[u]),this._isKingAttacked(n)||d.push(r[u]),this._undoMove();return d}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(typeof e=="object"){const o=this._moves();for(let r=0,n=o.length;r<n;r++)if(e.from===E(o[r].from)&&e.to===E(o[r].to)&&(!("promotion"in o[r])||e.promotion===o[r].promotion)){s=o[r];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=this._makePretty(s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=U(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&_.EP_CAPTURE&&(this._turn===I?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===S){if(this._kings[t]=e.to,e.flags&_.KSIDE_CASTLE){const i=e.to-1,o=e.to+1;this._board[i]=this._board[o],delete this._board[o]}else if(e.flags&_.QSIDE_CASTLE){const i=e.to+1,o=e.to-2;this._board[i]=this._board[o],delete this._board[o]}this._castling[t]=0}if(this._castling[t]){for(let i=0,o=O[t].length;i<o;i++)if(e.from===O[t][i].square&&this._castling[t]&O[t][i].flag){this._castling[t]^=O[t][i].flag;break}}if(this._castling[s]){for(let i=0,o=O[s].length;i<o;i++)if(e.to===O[s][i].square&&this._castling[s]&O[s][i].flag){this._castling[s]^=O[s][i].flag;break}}e.flags&_.BIG_PAWN?t===I?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=P,e.piece===y?this._halfMoves=0:e.flags&(_.CAPTURE|_.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===I&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=U(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&_.EP_CAPTURE){let o;s===I?o=t.to-16:o=t.to+16,this._board[o]={type:y,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(_.KSIDE_CASTLE|_.QSIDE_CASTLE)){let o,r;t.flags&_.KSIDE_CASTLE?(o=t.to+1,r=t.to-1):(o=t.to-2,r=t.to+1),this._board[o]=this._board[r],delete this._board[r]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let i=!1;for(const d in this._header)s.push("["+d+' "'+this._header[d]+'"]'+e),i=!0;i&&this._history.length&&s.push(e);const o=d=>{const m=this._comments[this.fen()];if(typeof m<"u"){const u=d.length>0?" ":"";d=`${d}${u}{${m}}`}return d},r=[];for(;this._history.length>0;)r.push(this._undoMove());const n=[];let l="";for(r.length===0&&n.push(o(""));r.length>0;){l=o(l);const d=r.pop();if(!d)break;if(!this._history.length&&d.color==="b"){const m=`${this._moveNumber}. ...`;l=l?`${l} ${m}`:m}else d.color==="w"&&(l.length&&n.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(d,this._moves({legal:!0})),this._makeMove(d)}if(l.length&&n.push(o(l)),typeof this._header.Result<"u"&&n.push(this._header.Result),t===0)return s.join("")+n.join(" ");const h=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},f=function(d,m){for(const u of m.split(" "))if(u){if(d+u.length>t){for(;h();)d--;s.push(e),d=0}s.push(u),d+=u.length,s.push(" "),d++}return h()&&d--,d};let p=0;for(let d=0;d<n.length;d++){if(p+n[d].length>t&&n[d].includes("{")){p=f(p,n[d]);continue}p+n[d].length>t&&d!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),p=0):d!==0&&(s.push(" "),p++),s.push(n[d]),p+=n[d].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){function i(x){return x.replace(/\\/g,"\\")}function o(x){const N={},j=x.split(new RegExp(i(s)));let q="",H="";for(let Q=0;Q<j.length;Q++){const Y=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;q=j[Q].replace(Y,"$1"),H=j[Q].replace(Y,"$2"),q.trim().length>0&&(N[q]=H)}return N}e=e.trim();const n=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),l=n&&n.length>=2?n[1]:"";this.reset();const h=o(l);let f="";for(const x in h)x.toLowerCase()==="fen"&&(f=h[x]),this.header(x,h[x]);if(!t)f&&this.load(f,{preserveHeaders:!0});else if(h.SetUp==="1"){if(!("FEN"in h))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(h.FEN,{preserveHeaders:!0})}function p(x){return Array.from(x).map(function(N){return N.charCodeAt(0)<128?N.charCodeAt(0).toString(16):encodeURIComponent(N).replace(/%/g,"").toLowerCase()}).join("")}function d(x){return x.length==0?"":decodeURIComponent("%"+(x.match(/.{1,2}/g)||[]).join("%"))}const m=function(x){return x=x.replace(new RegExp(i(s),"g")," "),`{${p(x.slice(1,x.length-1))}}`},u=function(x){if(x.startsWith("{")&&x.endsWith("}"))return d(x.slice(1,x.length-1))};let g=e.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(x,N,j){return N!==void 0?m(N):" "+m(`{${j.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const v=/(\([^()]+\))+?/g;for(;v.test(g);)g=g.replace(v,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");let k=g.trim().split(new RegExp(/\s+/));k=k.filter(x=>x!=="");let L="";for(let x=0;x<k.length;x++){const N=u(k[x]);if(N!==void 0){this._comments[this.fen()]=N;continue}const j=this._moveFromSan(k[x],t);if(j==null)if(qe.indexOf(k[x])>-1)L=k[x];else throw new Error(`Invalid move in PGN: ${k[x]}`);else L="",this._makeMove(j),this._incPositionCount(this.fen())}L&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",L)}_moveToSan(e,t){let s="";if(e.flags&_.KSIDE_CASTLE)s="O-O";else if(e.flags&_.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==y){const i=Fe(e,t);s+=e.piece.toUpperCase()+i}e.flags&(_.CAPTURE|_.EP_CAPTURE)&&(e.piece===y&&(s+=E(e.from)[0]),s+="x"),s+=E(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=oe(e);let i=ue(s),o=this._moves({legal:!0,piece:i});for(let d=0,m=o.length;d<m;d++)if(s===oe(this._moveToSan(o[d],o)))return o[d];if(t)return null;let r,n,l,h,f,p=!1;if(n=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),n?(r=n[1],l=n[2],h=n[3],f=n[4],l.length==1&&(p=!0)):(n=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),n&&(r=n[1],l=n[2],h=n[3],f=n[4],l.length==1&&(p=!0))),i=ue(s),o=this._moves({legal:!0,piece:r||i}),!h)return null;for(let d=0,m=o.length;d<m;d++)if(l){if((!r||r.toLowerCase()==o[d].piece)&&b[l]==o[d].from&&b[h]==o[d].to&&(!f||f.toLowerCase()==o[d].promotion))return o[d];if(p){const u=E(o[d].from);if((!r||r.toLowerCase()==o[d].piece)&&b[h]==o[d].to&&(l==u[0]||l==u[1])&&(!f||f.toLowerCase()==o[d].promotion))return o[d]}}else if(s===oe(this._moveToSan(o[d],o)).replace("x",""))return o[d];return null}ascii(){let e=`   +------------------------+
`;for(let t=b.a8;t<=b.h1;t++){if(V(t)===0&&(e+=" "+"87654321"[D(t)]+" |"),this._board[t]){const s=this._board[t].type,o=this._board[t].color===C?s.toUpperCase():s.toLowerCase();e+=" "+o+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let o=0,r=t.length;o<r;o++)this._makeMove(t[o]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:t,piece:s,from:i,to:o,flags:r,captured:n,promotion:l}=e;let h="";for(const m in _)_[m]&r&&(h+=Ce[m]);const f=E(i),p=E(o),d={color:t,piece:s,from:f,to:p,san:this._moveToSan(e,this._moves({legal:!0})),flags:h,lan:f+p,before:this.fen(),after:""};return this._makeMove(e),d.after=this.fen(),this._undoMove(),n&&(d.captured=n),l&&(d.promotion=l,d.lan+=l),d}turn(){return this._turn}board(){const e=[];let t=[];for(let s=b.a8;s<=b.h1;s++)this._board[s]==null?t.push(null):t.push({square:E(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in b){const t=b[e];return(D(t)+V(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(this._makePretty(i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=ne(e);return this._positionCount[t]||0}_incPositionCount(e){const t=ne(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=ne(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[S,K])t[i]!==void 0&&(t[i]?this._castling[e]|=J[i]:this._castling[e]&=~J[i]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[S]===void 0||t[S]===s[S])&&(t[K]===void 0||t[K]===s[K])}getCastlingRights(e){return{[S]:(this._castling[e]&J[S])!==0,[K]:(this._castling[e]&J[K])!==0}}moveNumber(){return this._moveNumber}}const _e=[{id:1,name:"Pawn Parade",description:"March your pawns forward! But watch out for the Careful Turtle.",fen:"4k3/pppppppp/8/8/8/8/PPPPPPPP/4K3 w - - 0 1",aiPersonality:"random",opponentName:"Careful Turtle",colorClass:"bg-emerald-400",icon:T("ðŸ¢")},{id:2,name:"Tower Power",description:"Rooks move fast and straight. Can you beat the Brave Lion?",fen:"r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1",aiPersonality:"aggressive",opponentName:"Brave Lion",colorClass:"bg-orange-400",icon:T("ðŸ¦")},{id:3,name:"Tricky Knights",description:"Knights jump over other pieces! The Monkey loves to jump around.",fen:"n3k1n1/pppppppp/8/8/8/8/PPPPPPPP/N3K1N1 w - - 0 1",aiPersonality:"random",opponentName:"Tricky Monkey",colorClass:"bg-yellow-400",icon:T("ðŸ’")},{id:4,name:"Royal Kingdom",description:"The full army has arrived. Outsmart the Fox to win!",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Clever Fox",colorClass:"bg-indigo-400",icon:T("ðŸ¦Š")}],ae=[{id:100,name:"Standard Chess",description:"Full game against the computer.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Robot",colorClass:"bg-blue-500",icon:T("ðŸ¤–"),isPvp:!1},{id:101,name:"Player vs Player",description:"Challenge a friend on the same screen.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"random",opponentName:"Player 2",colorClass:"bg-rose-500",icon:T("ðŸ‘¥"),isPvp:!0}],B=[..._e,...ae],ve={containerBg:"bg-white dark:bg-slate-800",borderColor:"border-slate-200 dark:border-slate-900",gridBg:"bg-slate-100 dark:bg-slate-950",lightSquare:"bg-[#F8FAFC] dark:bg-slate-700",darkSquare:"bg-[#CFE2FF] dark:bg-slate-600",labelLight:"text-slate-400 dark:text-slate-500",labelDark:"text-blue-400/50 dark:text-slate-500",highlight:"bg-indigo-500/20",lastMove:"bg-amber-400/20",check:"bg-rose-500/30",validMoveDot:"bg-indigo-500/30",captureRing:"border-indigo-500/40"},ee={WHITE:{stroke:"#92400E",text:"text-amber-400"},BLACK:{stroke:"#312E81",text:"text-indigo-400"}},X={p:1,n:3,b:3,r:5,q:9,k:0},Ke=(c,e)=>{const s=new $(c).moves({verbose:!0});if(s.length===0)return null;if(e==="random"&&Math.random()>.3)return s[Math.floor(Math.random()*s.length)];if(e==="aggressive"){s.sort((o,r)=>{const n=o.captured?X[o.captured]:0;return(r.captured?X[r.captured]:0)-n});const i=s[0];if(i.captured)return i}if(e==="defensive"){const i=s.filter(o=>{const r=new $(c);return r.move(o),!r.moves({verbose:!0}).some(h=>h.to===o.to)});if(i.length>0){i.sort((r,n)=>{const l=r.captured?X[r.captured]:0;return(n.captured?X[n.captured]:0)-l});const o=i.slice(0,3);return o[Math.floor(Math.random()*o.length)]}}return s[Math.floor(Math.random()*s.length)]};let w=null;const te="chess-kiddo-state-v1",W=c=>{if(typeof window<"u"){const{fen:e,history:t,savedLevelId:s,isPlayerTurn:i,winner:o,isGameOver:r,lastMove:n}=c;if(s){const l={fen:e,history:t,savedLevelId:s,isPlayerTurn:i,winner:o,isGameOver:r,lastMove:n};window.localStorage.setItem(te,JSON.stringify(l))}}},Be=()=>{const c={game:new $,fen:new $().fen(),levelId:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Select a level to start!",showFeedback:!1,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[],hasSavedGame:!1,savedLevelId:null};if(typeof window<"u")try{const e=window.localStorage.getItem(te);if(e){const t=JSON.parse(e);if(t.savedLevelId&&t.fen)return{...c,...t,levelId:null,game:new $(t.fen),hasSavedGame:!t.isGameOver}}}catch(e){console.warn("Failed to load Chess Kiddo state",e)}return c},le=Se((c,e)=>({...Be(),startLevel:t=>{const s=B.find(r=>r.id===t);if(!s)return;A("start");const i=new $(s.fen),o={game:i,fen:i.fen(),levelId:t,savedLevelId:t,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:s.id>=100?"":s.isPvp?"White's Turn":"Your turn! Tap a white piece.",showFeedback:s.id<100,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[i.fen()],hasSavedGame:!0};c(o),W(o),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)},resumeGame:()=>{const{savedLevelId:t,fen:s,isGameOver:i}=e();if(!t)return;A("click");const o=new $(s);c({levelId:t,game:o,feedback:i?"Game Over":"Welcome back!",showFeedback:!0}),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),2e3)},selectSquare:t=>{const{game:s,isPlayerTurn:i,isGameOver:o,selectedSquare:r,levelId:n}=e();if(!i||o)return;const l=B.find(m=>m.id===n),h=l==null?void 0:l.isPvp,f=s.turn();if(r===t){c({selectedSquare:null,possibleMoves:[],promotionMoves:[]});return}const p=s.get(t);let d=!1;if(p&&(h?d=p.color===f:d=p.color==="w"&&f==="w"),d){const m=s.moves({square:t,verbose:!0}),u=m.filter(v=>v.promotion).map(v=>v.to);A("click");const g=u.length>0;c({selectedSquare:t,possibleMoves:m.map(v=>v.to),promotionMoves:u,feedback:g?"Promote your pawn!":e().feedback,showFeedback:!!g}),g&&w&&clearTimeout(w)}else r&&e().makeMove(t)},makeMove:t=>{const{game:s,selectedSquare:i,levelId:o}=e();if(!i)return;const r=B.find(h=>h.id===o),n=r==null?void 0:r.isPvp,l=((r==null?void 0:r.id)||0)>=100;try{const f=s.moves({verbose:!0}).find(d=>d.from===i&&d.to===t&&(!d.promotion||d.promotion==="q"));if(!f){c({selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Invalid Move",showFeedback:!0}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),1500);return}const p=s.move(f.san);if(p){p.captured?A("drop"):A("tap");const d=[...e().history,s.fen()];let m="";s.isCheck()?m="Check!":p.promotion?m="Pawn Promoted! ðŸ‘‘":p.captured&&!l?m="Captured!":l||n||(m="Nice move!");const u={fen:s.fen(),selectedSquare:null,possibleMoves:[],promotionMoves:[],lastMove:{from:p.from,to:p.to},history:d,feedback:m,showFeedback:!!m};if(c(u),w&&clearTimeout(w),m&&(w=setTimeout(()=>e().hideFeedback(),2e3)),s.isGameOver()){const g=s.isDraw(),v={isGameOver:!0,winner:g?"draw":"player",feedback:g?"It's a tie!":n?p.color==="w"?"White Wins!":"Black Wins!":"You won!",showFeedback:!0,hasSavedGame:!1};c(v),g||A("win"),typeof window<"u"&&window.localStorage.removeItem(te)}else n?(c({isPlayerTurn:!0}),W({...e(),...u})):(c({isPlayerTurn:!1}),W({...e(),...u}),setTimeout(()=>e().botMove(),1e3))}}catch(h){console.error(h),c({selectedSquare:null,possibleMoves:[],promotionMoves:[]})}},botMove:()=>{const{game:t,levelId:s}=e();if(t.isGameOver())return;const i=B.find(l=>l.id===s);if(i!=null&&i.isPvp)return;const o=((i==null?void 0:i.id)||0)>=100,r=(i==null?void 0:i.aiPersonality)||"random",n=Ke(t.fen(),r);if(n){t.move(n),n.captured?A("drop"):A("tap");const l=[...e().history,t.fen()];let h="";t.isCheck()?h="Watch out! Check!":o||(h=`${(i==null?void 0:i.opponentName)||"Opponent"} moved.`);const f={fen:t.fen(),isPlayerTurn:!0,lastMove:{from:n.from,to:n.to},history:l,feedback:h,showFeedback:!!h};if(c(f),W({...e(),...f}),w&&clearTimeout(w),h&&(w=setTimeout(()=>e().hideFeedback(),2e3)),t.isGameOver()){const p=t.isDraw();c({isGameOver:!0,winner:p?"draw":"bot",feedback:p?"It's a tie!":"Oh no! Try again?",showFeedback:!0,hasSavedGame:!1}),typeof window<"u"&&window.localStorage.removeItem(te)}}},giveHint:()=>{const{game:t,isPlayerTurn:s,isGameOver:i,levelId:o}=e();if(!s||i)return;const r=B.find(l=>l.id===o);if(((r==null?void 0:r.id)||0)>=100)return;const n=t.moves({verbose:!0});if(n.length>0){const l=n.filter(f=>f.captured||f.promotion),h=l.length>0?l[Math.floor(Math.random()*l.length)]:n[Math.floor(Math.random()*n.length)];c({selectedSquare:h.from,possibleMoves:n.filter(f=>f.from===h.from).map(f=>f.to),promotionMoves:[],feedback:"Try this move!",showFeedback:!0}),A("click"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)}},hideFeedback:()=>{c({showFeedback:!1})},undo:()=>{const{history:t,levelId:s}=e();if(t.length<=1)return;const i=B.find(f=>f.id===s),o=i!=null&&i.isPvp?1:2;if(t.length<=o){e().startLevel(s);return}const r=t.slice(0,t.length-o),n=r[r.length-1],h={game:new $(n),fen:n,history:r,isPlayerTurn:!0,isGameOver:!1,winner:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Time travel!",showFeedback:((i==null?void 0:i.id)||0)<100};c(h),W({...e(),...h}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),2e3)},exitLevel:()=>{c({levelId:null,showFeedback:!1}),w&&clearTimeout(w)}})),me=({level:c,isSelected:e,onClick:t})=>a.jsxs("button",{onClick:()=>t(c.id),className:`
        group relative
        flex flex-col items-center text-center
        p-6 rounded-3xl
        bg-white dark:bg-slate-800
        border-2 
        shadow-xl transition-all duration-300
        h-full
        ${e?`border-${c.colorClass.split("-")[1]}-500 ring-4 ring-${c.colorClass.split("-")[1]}-500/20 scale-[1.02] z-10`:"border-slate-200 dark:border-slate-700 hover:shadow-2xl hover:-translate-y-1 hover:border-indigo-400"}
        `,children:[a.jsx("div",{className:`
        w-20 h-20 rounded-full flex items-center justify-center text-5xl mb-4
        ${c.colorClass} text-white shadow-lg group-hover:scale-110 transition-transform font-emoji
        `,children:c.icon}),a.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:c.name}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed mb-4",children:c.description}),a.jsx("div",{className:"mt-auto",children:a.jsxs("span",{className:"inline-block px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs font-bold text-slate-600 dark:text-slate-300 uppercase tracking-wider",children:["VS ",c.opponentName]})}),e&&a.jsx("div",{className:`absolute top-4 right-4 text-2xl font-bold animate-bounce-in text-${c.colorClass.split("-")[1]}-500`,children:"âœ“"})]}),$e=()=>{const{startLevel:c,hasSavedGame:e,resumeGame:t,savedLevelId:s}=le(),[i,o]=G.useState(!1),[r,n]=G.useState(s||ae[0].id),l=s?B.find(f=>f.id===s):null;if(i)return a.jsx(ye,{gameId:"chess-kiddo",onBack:()=>o(!1)});const h=()=>{r&&c(r)};return a.jsxs("div",{className:"flex flex-col h-full w-full bg-slate-50 dark:bg-[#0f172a] animate-fade-in relative",children:[a.jsxs("div",{className:"flex-1 overflow-y-auto",children:[a.jsxs("div",{className:"max-w-4xl mx-auto p-4 md:p-8 space-y-12 text-center pb-32",children:[a.jsxs("div",{className:"space-y-2 pt-4",children:[a.jsx("div",{className:"inline-block text-6xl mb-2 animate-bounce font-emoji",children:T("â™Ÿï¸")}),a.jsx("h1",{className:"text-4xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight",children:"Chess Kiddo"}),a.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-400 font-medium",children:"Choose a mode to play!"})]}),e&&l&&a.jsxs("div",{className:"animate-pop",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-xl border-l-8 border-indigo-500 flex flex-col sm:flex-row items-center justify-between gap-6 max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-left",children:[a.jsx("h2",{className:"text-2xl font-black text-slate-900 dark:text-white",children:"Game in Progress"}),a.jsxs("p",{className:"text-slate-500 dark:text-slate-400",children:["Resume: ",a.jsx("span",{className:"font-bold text-indigo-500",children:l.name})]})]}),a.jsx(R,{onClick:t,size:"lg",className:"w-full sm:w-auto !bg-indigo-500 hover:!bg-indigo-400 whitespace-nowrap !rounded-xl !py-4 !px-8 text-lg shadow-lg shadow-indigo-500/30",children:"Continue Game"})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-8 mb-4 max-w-2xl mx-auto",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-slate-400",children:"Or Start New Game"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Quick Play"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:ae.map(f=>a.jsx(me,{level:f,isSelected:r===f.id,onClick:n},f.id))})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Learning Missions"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:_e.map(f=>a.jsx(me,{level:f,isSelected:r===f.id,onClick:n},f.id))})]})]}),a.jsx(ce,{className:"md:hidden",onStart:h,onHowToPlay:()=>o(!0),startLabel:"Start Level",startDisabled:!r,startColorClass:"!bg-indigo-500 hover:!bg-indigo-400"})]}),a.jsx("div",{className:"hidden md:block w-full",children:a.jsx(ce,{onStart:h,onHowToPlay:()=>o(!0),startLabel:"Start Level",startDisabled:!r,startColorClass:"!bg-indigo-500 hover:!bg-indigo-400"})})]})},De={p:T("â™Ÿ"),n:T("â™ž"),b:T("â™"),r:T("â™œ"),q:T("â™›"),k:T("â™š")},Ge=G.memo(({type:c,color:e})=>{const t=De[c],i=e==="w"?ee.WHITE:ee.BLACK,o=i.stroke,r=`
    0.02em 0.02em 0 ${o},
    -0.02em -0.02em 0 ${o},
    0.02em -0.02em 0 ${o},
    -0.02em 0.02em 0 ${o},
    0 0.04em 0.1em rgba(0,0,0,0.2)
  `;return a.jsx("div",{className:"relative w-full h-full flex items-center justify-center pointer-events-none select-none overflow-visible",children:a.jsx("div",{className:`
            leading-none 
            transition-transform duration-200
            ${i.text}
            pb-[10%]
            will-change-transform
            flex items-center justify-center
            font-emoji
        `,style:{fontSize:"75cqmin",textShadow:r,filter:"drop-shadow(0 4px 4px rgba(0,0,0,0.1))"},children:a.jsx("span",{children:t})})})}),He=G.memo(({square:c,piece:e,bgClass:t,labelColorClass:s,isSelected:i,isPossibleMove:o,isPromotionMove:r,isLastMove:n,isCheck:l,onClick:h})=>{const f=ve;return a.jsx("div",{onClick:h,className:"relative w-full h-full p-0.5 md:p-1",style:{containerType:"size"},children:a.jsxs("div",{className:`
                relative w-full h-full flex items-center justify-center
                rounded-md md:rounded-lg
                ${t}
                ${o||r?"cursor-pointer":""}
                transition-all duration-200
                shadow-sm
                border-b-2 border-black/5 dark:border-white/5
            `,children:[i&&a.jsx("div",{className:`absolute inset-0 ${f.highlight} z-0 rounded-md md:rounded-lg ring-inset ring-4 ring-indigo-500/50`}),n&&!i&&a.jsx("div",{className:`absolute inset-0 ${f.lastMove} z-0 rounded-md md:rounded-lg`}),l&&a.jsx("div",{className:`absolute inset-0 ${f.check} z-0 animate-pulse rounded-md md:rounded-lg ring-inset ring-4 ring-rose-500/50`}),(c.includes("1")||c.includes("a"))&&a.jsx("span",{className:`absolute bottom-0.5 left-1 text-[7px] md:text-[9px] font-black select-none z-0 ${s} opacity-80`,children:c.toUpperCase()}),o&&!e&&!r&&a.jsx("div",{className:`absolute w-[20%] h-[20%] ${f.validMoveDot} rounded-full z-10 border border-indigo-500/20`}),o&&e&&!r&&a.jsx("div",{className:`absolute inset-[8%] border-4 border-dashed ${f.captureRing} rounded-full z-10 animate-spin-slow`,style:{animationDuration:"10s"}}),e&&a.jsx("div",{className:"relative z-10 w-full h-full flex items-center justify-center transform transition-transform group-active:scale-90",children:a.jsx(Ge,{type:e.type,color:e.color})})]})})}),Qe=()=>{const{game:c,fen:e,selectedSquare:t,possibleMoves:s,promotionMoves:i,lastMove:o,selectSquare:r}=le(),{enableTilt:n}=be(),l=ve,h=G.useMemo(()=>c.board(),[e,c]),f=["a","b","c","d","e","f","g","h"],p=[8,7,6,5,4,3,2,1],d=G.useMemo(()=>({width:"100%",maxWidth:"100%",aspectRatio:"1/1",transform:n?"rotateX(5deg)":"none"}),[n]);return a.jsx("div",{className:"relative w-full h-full flex items-center justify-center perspective-1000 p-2 md:p-6",children:a.jsx("div",{className:`
            relative
            w-full h-full
            rounded-2xl md:rounded-[2rem]
            p-2 md:p-3
            border-2
            transition-all duration-500 ease-out
            will-change-transform
            ${l.containerBg}
            ${l.borderColor}
            shadow-[0_10px_30px_rgba(0,0,0,0.15),_0_8px_0_#cbd5e1]
            dark:shadow-[0_10px_40px_rgba(0,0,0,0.5),_0_8px_0_#0f172a]
          `,style:d,children:a.jsx("div",{className:`
            relative
            w-full h-full
            ${l.gridBg}
            rounded-xl md:rounded-[1.5rem]
            overflow-hidden
            shadow-[inset_0_4px_12px_rgba(0,0,0,0.15)]
            border-4 border-slate-200 dark:border-slate-900
          `,children:a.jsx("div",{className:`
               w-full h-full 
               grid grid-cols-8 grid-rows-8 
               p-0.5 md:p-1
             `,children:h.map((m,u)=>m.map((g,v)=>{const k=`${f[v]}${p[u]}`,L=(u+v)%2===0,x=t===k,N=s.includes(k),j=i==null?void 0:i.includes(k),q=o?o.from===k||o.to===k:!1,H=(g==null?void 0:g.type)==="k"&&(g==null?void 0:g.color)===c.turn()&&c.isCheck(),Q=L?l.lightSquare:l.darkSquare,Y=L?l.labelLight:l.labelDark;return a.jsx(He,{square:k,piece:g,bgClass:Q,labelColorClass:Y,isSelected:x,isPossibleMove:N,isPromotionMove:j,isLastMove:q,isCheck:H,onClick:()=>r(k)},k)}))})})})})},pe=G.memo(({name:c,isWhite:e,isActive:t,alignment:s})=>{const i=s==="right",o=e?ee.WHITE:ee.BLACK;return a.jsxs("div",{className:`
        flex items-center gap-2 md:gap-4 transition-all duration-500
        ${t?"opacity-100 scale-100":"opacity-60 scale-95 grayscale-[0.3]"}
        ${i?"flex-row-reverse text-right":"flex-row text-left"}
    `,children:[a.jsxs("div",{className:`
          relative w-10 h-10 md:w-14 md:h-14 rounded-xl md:rounded-2xl flex items-center justify-center text-2xl md:text-4xl shadow-lg border-2
          ${e?"bg-white border-amber-400":"bg-white border-indigo-400"}
          ${t?"ring-2 ring-indigo-500/20 ring-offset-2 dark:ring-offset-slate-950":""}
          transition-all duration-300
       `,children:[a.jsx("span",{className:`${o.text} drop-shadow-sm font-black transform ${t?"scale-110":"scale-100"}`,style:{textShadow:`1px 1px 0 ${o.stroke}`,filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.1))"},children:e?"â™”":"â™š"}),t&&a.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-emerald-500 border-2 border-white dark:border-slate-800 rounded-full animate-ping"})]}),a.jsxs("div",{className:"flex flex-col justify-center min-w-0 max-w-[100px] md:max-w-[140px]",children:[a.jsx("span",{className:"font-bold text-slate-900 dark:text-white text-xs md:text-lg tracking-tight leading-none truncate",children:c}),a.jsx("div",{className:"flex items-center gap-1 mt-1",children:a.jsx("span",{className:`
                text-[9px] md:text-[10px] font-black uppercase tracking-wider px-1.5 py-0.5 rounded-full
                ${t?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300 animate-pulse":"bg-slate-200 text-slate-500 dark:bg-slate-800 dark:text-slate-500"}
            `,children:t?"Turn":"Wait"})})]})]})}),ge=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),Ue=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),We=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),ze=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),Ve=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),Ze=()=>{const{setView:c,players:e}=be(),{levelId:t,game:s,feedback:i,showFeedback:o,history:r,undo:n,giveHint:l,exitLevel:h,startLevel:f,isGameOver:p,winner:d}=le(),m=B.find(H=>H.id===t),u=((m==null?void 0:m.id)||0)>=100,g=m==null?void 0:m.isPvp,v=!u&&!p,k=g?e[de.ONE].name:"You",L=g?e[de.TWO].name:(m==null?void 0:m.opponentName)||"Opponent",x=s.turn(),N=()=>{h(),c(Ne.HOME)},j=()=>{h()},q=()=>{t&&f(t)};return!t||!m?a.jsxs("div",{className:"absolute inset-0 flex flex-col bg-slate-100 dark:bg-slate-900 overflow-hidden",children:[a.jsx("header",{className:"shrink-0 h-16 md:h-20 px-4 md:px-8 flex items-center justify-center z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md border-b border-slate-200/50 dark:border-white/5",children:a.jsx(R,{variant:"icon",size:"sm",onClick:N,title:"Return to Menu",children:a.jsx(ge,{})})}),a.jsx("div",{className:"flex-1 w-full relative overflow-hidden",children:a.jsx($e,{})})]}):a.jsxs("div",{className:"absolute inset-0 flex flex-col bg-slate-100 dark:bg-slate-950 transition-colors duration-500 overflow-hidden",children:[a.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[a.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-400/5 rounded-full blur-[80px]"}),a.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-400/5 rounded-full blur-[80px]"})]}),a.jsxs("header",{className:"shrink-0 h-16 md:h-20 px-3 md:px-8 flex items-center justify-between z-30 bg-white/60 dark:bg-slate-900/40 backdrop-blur-md border-b border-slate-200 dark:border-white/5 relative shadow-sm transition-colors duration-300",children:[a.jsx("div",{className:"flex-1 flex justify-start min-w-0",children:a.jsx(pe,{name:k,isWhite:!0,isActive:x==="w"&&!p,alignment:"left"})}),a.jsxs("div",{className:"shrink-0 flex items-center gap-1 md:gap-2 mx-2",children:[a.jsx(R,{variant:"icon",size:"sm",onClick:j,title:"Level Select",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(Ue,{})}),a.jsx(R,{variant:"icon",size:"sm",onClick:q,title:"Restart",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(Ve,{})}),v&&a.jsx(R,{variant:"icon",size:"sm",onClick:l,title:"Get a Hint",className:"w-9 h-9 md:w-11 md:h-11 p-2 !bg-indigo-50 !text-indigo-600 dark:!bg-indigo-900/30 dark:!text-indigo-300 border-indigo-100 dark:border-indigo-800 shadow-inner",children:a.jsx(ze,{})}),a.jsx(R,{variant:"icon",size:"sm",onClick:n,disabled:r.length<=1||p,title:"Undo Move",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(We,{})}),a.jsx(R,{variant:"icon",size:"sm",onClick:N,title:"Home",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(ge,{})})]}),a.jsx("div",{className:"flex-1 flex justify-end min-w-0",children:a.jsx(pe,{name:L,isWhite:!1,isActive:x==="b"&&!p,alignment:"right"})})]}),a.jsxs("main",{className:"flex-1 w-full h-full flex flex-col items-center justify-center p-2 relative z-10 perspective-1000 overflow-hidden",children:[a.jsxs("div",{className:"relative aspect-square portrait:w-full portrait:max-h-full landscape:h-full landscape:max-w-full flex items-center justify-center animate-fade-in",children:[a.jsx(Qe,{}),o&&i&&a.jsx("div",{className:"absolute top-4 pointer-events-none transition-all duration-300 transform z-20",children:a.jsxs("div",{className:"bg-white/95 dark:bg-slate-800/95 rounded-2xl px-6 py-2 shadow-xl border-b-4 border-indigo-500 flex items-center gap-3 animate-bounce-in",children:[a.jsx("span",{className:"text-2xl",children:m.icon}),a.jsx("p",{className:"text-slate-900 dark:text-white font-black text-sm md:text-lg tracking-tight uppercase",children:i})]})})]}),p&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 md:p-12 rounded-[3rem] text-center shadow-2xl max-w-md w-full border-b-8 border-indigo-500",children:[a.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-6xl mb-8 shadow-inner rotate-3",children:d==="player"?"ðŸ‘‘":d==="draw"?"ðŸ¤":"ðŸ’«"}),a.jsx("h2",{className:"text-4xl font-black text-slate-900 dark:text-white mb-4 tracking-tight",children:d==="player"?g?s.turn()==="b"?"White Wins!":"Black Wins!":"Victory!":d==="draw"?"Match Draw":"Nice Effort!"}),a.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-10 font-bold text-lg leading-relaxed",children:d==="player"?"You played like a champion!":"That was a close one. Ready to try again?"}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(R,{onClick:q,size:"lg",className:"w-full !rounded-2xl !py-5 !text-2xl shadow-xl shadow-indigo-500/30",children:"Play Again"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsx(R,{onClick:j,variant:"secondary",className:"w-full !rounded-2xl !py-4 font-bold !bg-slate-100 dark:!bg-slate-700 text-slate-600 dark:text-slate-300 border-none",children:"Levels"}),a.jsx(R,{onClick:N,variant:"secondary",className:"w-full !rounded-2xl !py-4 font-bold !bg-slate-100 dark:!bg-slate-700 text-slate-600 dark:text-slate-300 border-none",children:"Home"})]})]})]})})]})]})};export{Ze as ChessKiddoGame};
