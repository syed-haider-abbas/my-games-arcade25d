var xe=Object.defineProperty;var ve=(d,e,t)=>e in d?xe(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var M=(d,e,t)=>ve(d,typeof e!="symbol"?e+"":e,t);import{c as ke,p as A,j as a,B as L,r as W,u as me,P as ae,V as we}from"./index-Dal3CgWx.js";/**
 * @license
 * Copyright (c) 2023, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const C="w",T="b",N="p",oe="n",X="b",H="r",F="q",S="k",te="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",P=-1,Se={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},x={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},b={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},se={b:[16,32,17,15],w:[-16,-32,-17,-15]},le={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ye=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Ne=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ce={p:1,n:2,b:4,r:8,q:16,k:32},Pe="pnbrqkPNBRQK",ce=[oe,X,H,F],je=7,Ee=6,Me=1,Te=0,Y={[S]:x.KSIDE_CASTLE,[F]:x.QSIDE_CASTLE},q={w:[{square:b.a1,flag:x.QSIDE_CASTLE},{square:b.h1,flag:x.KSIDE_CASTLE}],b:[{square:b.a8,flag:x.QSIDE_CASTLE},{square:b.h8,flag:x.KSIDE_CASTLE}]},Ie={b:Me,w:Ee},Ae=["1-0","0-1","1/2-1/2","*"];function D(d){return d>>4}function z(d){return d&15}function pe(d){return"0123456789".indexOf(d)!==-1}function E(d){const e=z(d),t=D(d);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function Q(d){return d===C?T:C}function Le(d){const e=d.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let r=0;r<i.length;r++){let o=0,l=!1;for(let h=0;h<i[r].length;h++)if(pe(i[r][h])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(i[r][h],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[r][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,l=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:r,regex:o}of n){if(!o.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${r} king`};if((e[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${r} kings`}}return Array.from(i[0]+i[7]).some(r=>r.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Re(d,e){const t=d.from,s=d.to,i=d.piece;let n=0,r=0,o=0;for(let l=0,h=e.length;l<h;l++){const u=e[l].from,p=e[l].to,c=e[l].piece;i===c&&t!==u&&s===p&&(n++,D(t)===D(u)&&r++,z(t)===z(u)&&o++)}return n>0?r>0&&o>0?E(t):o>0?E(t).charAt(1):E(t).charAt(0):""}function O(d,e,t,s,i,n=void 0,r=x.NORMAL){const o=D(s);if(i===N&&(o===je||o===Te))for(let l=0;l<ce.length;l++){const h=ce[l];d.push({color:e,from:t,to:s,piece:i,captured:n,promotion:h,flags:r|x.PROMOTION})}else d.push({color:e,from:t,to:s,piece:i,captured:n,flags:r})}function de(d){let e=d.charAt(0);return e>="a"&&e<="h"?d.match(/[a-h]\d.*[a-h]\d/)?void 0:N:(e=e.toLowerCase(),e==="o"?S:e)}function ie(d){return d.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function ne(d){return d.split(" ").slice(0,4).join(" ")}class B{constructor(e=te){M(this,"_board",new Array(128));M(this,"_turn",C);M(this,"_header",{});M(this,"_kings",{w:P,b:P});M(this,"_epSquare",-1);M(this,"_halfMoves",0);M(this,"_moveNumber",0);M(this,"_history",[]);M(this,"_comments",{});M(this,"_castling",{w:0,b:0});M(this,"_positionCount",{});this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:P,b:P},this._turn=C,this._castling={w:0,b:0},this._epSquare=P,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const o=["-","-","0","1"];e=i.concat(o.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:o,error:l}=Le(e);if(!o)throw new Error(l)}const n=i[0];let r=0;this.clear({preserveHeaders:s});for(let o=0;o<n.length;o++){const l=n.charAt(o);if(l==="/")r+=8;else if(pe(l))r+=parseInt(l,10);else{const h=l<"a"?C:T;this._put({type:l.toLowerCase(),color:h},E(r)),r++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=x.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=x.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=x.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=x.QSIDE_CASTLE),this._epSquare=i[3]==="-"?P:b[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var n,r;let e=0,t="";for(let o=b.a8;o<=b.h1;o++){if(this._board[o]){e>0&&(t+=e,e=0);const{color:l,type:h}=this._board[o];t+=l===C?h.toUpperCase():h.toLowerCase()}else e++;o+1&136&&(e>0&&(t+=e),o!==b.h1&&(t+="/"),e=0,o+=8)}let s="";this._castling[C]&x.KSIDE_CASTLE&&(s+="K"),this._castling[C]&x.QSIDE_CASTLE&&(s+="Q"),this._castling[T]&x.KSIDE_CASTLE&&(s+="k"),this._castling[T]&x.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==P){const o=this._epSquare+(this._turn===C?16:-16),l=[o+1,o-1];for(const h of l){if(h&136)continue;const u=this._turn;if(((n=this._board[h])==null?void 0:n.color)===u&&((r=this._board[h])==null?void 0:r.type)===N){this._makeMove({color:u,from:h,to:this._epSquare,piece:N,captured:N,flags:x.EP_CAPTURE});const p=!this._isKingAttacked(u);if(this._undoMove(),p){i=E(this._epSquare);break}}}}return[t,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==te?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(te)}get(e){return this._board[b[e]]||!1}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},s){if(Pe.indexOf(e.toLowerCase())===-1||!(s in b))return!1;const i=b[s];if(e==S&&!(this._kings[t]==P||this._kings[t]==i))return!1;const n=this._board[i];return n&&n.type===S&&(this._kings[n.color]=P),this._board[i]={type:e,color:t},e===S&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[b[e]],t&&t.type===S&&(this._kings[t.color]=P),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,i,n,r,o,l,h,u,p,c,m,f;const e=((s=this._board[b.e1])==null?void 0:s.type)===S&&((i=this._board[b.e1])==null?void 0:i.color)===C,t=((n=this._board[b.e8])==null?void 0:n.type)===S&&((r=this._board[b.e8])==null?void 0:r.color)===T;(!e||((o=this._board[b.a1])==null?void 0:o.type)!==H||((l=this._board[b.a1])==null?void 0:l.color)!==C)&&(this._castling.w&=-65),(!e||((h=this._board[b.h1])==null?void 0:h.type)!==H||((u=this._board[b.h1])==null?void 0:u.color)!==C)&&(this._castling.w&=-33),(!t||((p=this._board[b.a8])==null?void 0:p.type)!==H||((c=this._board[b.a8])==null?void 0:c.color)!==T)&&(this._castling.b&=-65),(!t||((m=this._board[b.h8])==null?void 0:m.type)!==H||((f=this._board[b.h8])==null?void 0:f.color)!==T)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var n,r;if(this._epSquare===P)return;const e=this._epSquare+(this._turn===C?-16:16),t=this._epSquare+(this._turn===C?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((n=this._board[t])==null?void 0:n.color)!==Q(this._turn)||((r=this._board[t])==null?void 0:r.type)!==N){this._epSquare=P;return}const i=o=>{var l,h;return!(o&136)&&((l=this._board[o])==null?void 0:l.color)===this._turn&&((h=this._board[o])==null?void 0:h.type)===N};s.some(i)||(this._epSquare=P)}_attacked(e,t){for(let s=b.a8;s<=b.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const i=this._board[s],n=s-t;if(n===0)continue;const r=n+119;if(ye[r]&Ce[i.type]){if(i.type===N){if(n>0){if(i.color===C)return!0}else if(i.color===T)return!0;continue}if(i.type==="n"||i.type==="k")return!0;const o=Ne[r];let l=s+o,h=!1;for(;l!==t;){if(this._board[l]!=null){h=!0;break}l+=o}if(!h)return!0}}return!1}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(Q(e),t)}isAttacked(e,t){return this._attacked(t,b[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let n=b.a8;n<=b.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const r=this._board[n];r&&(e[r.type]=r.type in e?e[r.type]+1:1,r.type===X&&t.push(i),s++)}if(s===2)return!0;if(s===3&&(e[X]===1||e[oe]===1))return!0;if(s===e[X]+2){let n=0;const r=t.length;for(let o=0;o<r;o++)n+=t[o];if(n===0||n===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const i=this._moves({square:t,piece:s});return e?i.map(n=>this._makePretty(n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var m;const i=s?s.toLowerCase():void 0,n=t==null?void 0:t.toLowerCase(),r=[],o=this._turn,l=Q(o);let h=b.a8,u=b.h1,p=!1;if(i)if(i in b)h=u=b[i],p=!0;else return[];for(let f=h;f<=u;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===l)continue;const{type:g}=this._board[f];let v;if(g===N){if(n&&n!==g)continue;v=f+se[o][0],this._board[v]||(O(r,o,f,v,N),v=f+se[o][1],Ie[o]===D(f)&&!this._board[v]&&O(r,o,f,v,N,void 0,x.BIG_PAWN));for(let k=2;k<4;k++)v=f+se[o][k],!(v&136)&&(((m=this._board[v])==null?void 0:m.color)===l?O(r,o,f,v,N,this._board[v].type,x.CAPTURE):v===this._epSquare&&O(r,o,f,v,N,N,x.EP_CAPTURE))}else{if(n&&n!==g)continue;for(let k=0,I=le[g].length;k<I;k++){const _=le[g][k];for(v=f;v+=_,!(v&136);){if(!this._board[v])O(r,o,f,v,g);else{if(this._board[v].color===o)break;O(r,o,f,v,g,this._board[v].type,x.CAPTURE);break}if(g===oe||g===S)break}}}}if((n===void 0||n===S)&&(!p||u===this._kings[o])){if(this._castling[o]&x.KSIDE_CASTLE){const f=this._kings[o],g=f+2;!this._board[f+1]&&!this._board[g]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,f+1)&&!this._attacked(l,g)&&O(r,o,this._kings[o],g,S,void 0,x.KSIDE_CASTLE)}if(this._castling[o]&x.QSIDE_CASTLE){const f=this._kings[o],g=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,f-1)&&!this._attacked(l,g)&&O(r,o,this._kings[o],g,S,void 0,x.QSIDE_CASTLE)}}if(!e||this._kings[o]===-1)return r;const c=[];for(let f=0,g=r.length;f<g;f++)this._makeMove(r[f]),this._isKingAttacked(o)||c.push(r[f]),this._undoMove();return c}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(typeof e=="object"){const n=this._moves();for(let r=0,o=n.length;r<o;r++)if(e.from===E(n[r].from)&&e.to===E(n[r].to)&&(!("promotion"in n[r])||e.promotion===n[r].promotion)){s=n[r];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=this._makePretty(s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=Q(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&x.EP_CAPTURE&&(this._turn===T?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===S){if(this._kings[t]=e.to,e.flags&x.KSIDE_CASTLE){const i=e.to-1,n=e.to+1;this._board[i]=this._board[n],delete this._board[n]}else if(e.flags&x.QSIDE_CASTLE){const i=e.to+1,n=e.to-2;this._board[i]=this._board[n],delete this._board[n]}this._castling[t]=0}if(this._castling[t]){for(let i=0,n=q[t].length;i<n;i++)if(e.from===q[t][i].square&&this._castling[t]&q[t][i].flag){this._castling[t]^=q[t][i].flag;break}}if(this._castling[s]){for(let i=0,n=q[s].length;i<n;i++)if(e.to===q[s][i].square&&this._castling[s]&q[s][i].flag){this._castling[s]^=q[s][i].flag;break}}e.flags&x.BIG_PAWN?t===T?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=P,e.piece===N?this._halfMoves=0:e.flags&(x.CAPTURE|x.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===T&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=Q(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&x.EP_CAPTURE){let n;s===T?n=t.to-16:n=t.to+16,this._board[n]={type:N,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(x.KSIDE_CASTLE|x.QSIDE_CASTLE)){let n,r;t.flags&x.KSIDE_CASTLE?(n=t.to+1,r=t.to-1):(n=t.to-2,r=t.to+1),this._board[n]=this._board[r],delete this._board[r]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let i=!1;for(const c in this._header)s.push("["+c+' "'+this._header[c]+'"]'+e),i=!0;i&&this._history.length&&s.push(e);const n=c=>{const m=this._comments[this.fen()];if(typeof m<"u"){const f=c.length>0?" ":"";c=`${c}${f}{${m}}`}return c},r=[];for(;this._history.length>0;)r.push(this._undoMove());const o=[];let l="";for(r.length===0&&o.push(n(""));r.length>0;){l=n(l);const c=r.pop();if(!c)break;if(!this._history.length&&c.color==="b"){const m=`${this._moveNumber}. ...`;l=l?`${l} ${m}`:m}else c.color==="w"&&(l.length&&o.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(c,this._moves({legal:!0})),this._makeMove(c)}if(l.length&&o.push(n(l)),typeof this._header.Result<"u"&&o.push(this._header.Result),t===0)return s.join("")+o.join(" ");const h=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},u=function(c,m){for(const f of m.split(" "))if(f){if(c+f.length>t){for(;h();)c--;s.push(e),c=0}s.push(f),c+=f.length,s.push(" "),c++}return h()&&c--,c};let p=0;for(let c=0;c<o.length;c++){if(p+o[c].length>t&&o[c].includes("{")){p=u(p,o[c]);continue}p+o[c].length>t&&c!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),p=0):c!==0&&(s.push(" "),p++),s.push(o[c]),p+=o[c].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){function i(_){return _.replace(/\\/g,"\\")}function n(_){const y={},j=_.split(new RegExp(i(s)));let R="",$="";for(let G=0;G<j.length;G++){const V=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;R=j[G].replace(V,"$1"),$=j[G].replace(V,"$2"),R.trim().length>0&&(y[R]=$)}return y}e=e.trim();const o=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),l=o&&o.length>=2?o[1]:"";this.reset();const h=n(l);let u="";for(const _ in h)_.toLowerCase()==="fen"&&(u=h[_]),this.header(_,h[_]);if(!t)u&&this.load(u,{preserveHeaders:!0});else if(h.SetUp==="1"){if(!("FEN"in h))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(h.FEN,{preserveHeaders:!0})}function p(_){return Array.from(_).map(function(y){return y.charCodeAt(0)<128?y.charCodeAt(0).toString(16):encodeURIComponent(y).replace(/%/g,"").toLowerCase()}).join("")}function c(_){return _.length==0?"":decodeURIComponent("%"+(_.match(/.{1,2}/g)||[]).join("%"))}const m=function(_){return _=_.replace(new RegExp(i(s),"g")," "),`{${p(_.slice(1,_.length-1))}}`},f=function(_){if(_.startsWith("{")&&_.endsWith("}"))return c(_.slice(1,_.length-1))};let g=e.replace(l,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(_,y,j){return y!==void 0?m(y):" "+m(`{${j.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const v=/(\([^()]+\))+?/g;for(;v.test(g);)g=g.replace(v,"");g=g.replace(/\d+\.(\.\.)?/g,""),g=g.replace(/\.\.\./g,""),g=g.replace(/\$\d+/g,"");let k=g.trim().split(new RegExp(/\s+/));k=k.filter(_=>_!=="");let I="";for(let _=0;_<k.length;_++){const y=f(k[_]);if(y!==void 0){this._comments[this.fen()]=y;continue}const j=this._moveFromSan(k[_],t);if(j==null)if(Ae.indexOf(k[_])>-1)I=k[_];else throw new Error(`Invalid move in PGN: ${k[_]}`);else I="",this._makeMove(j),this._incPositionCount(this.fen())}I&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",I)}_moveToSan(e,t){let s="";if(e.flags&x.KSIDE_CASTLE)s="O-O";else if(e.flags&x.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==N){const i=Re(e,t);s+=e.piece.toUpperCase()+i}e.flags&(x.CAPTURE|x.EP_CAPTURE)&&(e.piece===N&&(s+=E(e.from)[0]),s+="x"),s+=E(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=ie(e);let i=de(s),n=this._moves({legal:!0,piece:i});for(let c=0,m=n.length;c<m;c++)if(s===ie(this._moveToSan(n[c],n)))return n[c];if(t)return null;let r,o,l,h,u,p=!1;if(o=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(r=o[1],l=o[2],h=o[3],u=o[4],l.length==1&&(p=!0)):(o=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(r=o[1],l=o[2],h=o[3],u=o[4],l.length==1&&(p=!0))),i=de(s),n=this._moves({legal:!0,piece:r||i}),!h)return null;for(let c=0,m=n.length;c<m;c++)if(l){if((!r||r.toLowerCase()==n[c].piece)&&b[l]==n[c].from&&b[h]==n[c].to&&(!u||u.toLowerCase()==n[c].promotion))return n[c];if(p){const f=E(n[c].from);if((!r||r.toLowerCase()==n[c].piece)&&b[h]==n[c].to&&(l==f[0]||l==f[1])&&(!u||u.toLowerCase()==n[c].promotion))return n[c]}}else if(s===ie(this._moveToSan(n[c],n)).replace("x",""))return n[c];return null}ascii(){let e=`   +------------------------+
`;for(let t=b.a8;t<=b.h1;t++){if(z(t)===0&&(e+=" "+"87654321"[D(t)]+" |"),this._board[t]){const s=this._board[t].type,n=this._board[t].color===C?s.toUpperCase():s.toLowerCase();e+=" "+n+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,r=t.length;n<r;n++)this._makeMove(t[n]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}_makePretty(e){const{color:t,piece:s,from:i,to:n,flags:r,captured:o,promotion:l}=e;let h="";for(const m in x)x[m]&r&&(h+=Se[m]);const u=E(i),p=E(n),c={color:t,piece:s,from:u,to:p,san:this._moveToSan(e,this._moves({legal:!0})),flags:h,lan:u+p,before:this.fen(),after:""};return this._makeMove(e),c.after=this.fen(),this._undoMove(),o&&(c.captured=o),l&&(c.promotion=l,c.lan+=l),c}turn(){return this._turn}board(){const e=[];let t=[];for(let s=b.a8;s<=b.h1;s++)this._board[s]==null?t.push(null):t.push({square:E(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in b){const t=b[e];return(D(t)+z(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(this._makePretty(i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=ne(e);return this._positionCount[t]||0}_incPositionCount(e){const t=ne(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=ne(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[S,F])t[i]!==void 0&&(t[i]?this._castling[e]|=Y[i]:this._castling[e]&=~Y[i]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[S]===void 0||t[S]===s[S])&&(t[F]===void 0||t[F]===s[F])}getCastlingRights(e){return{[S]:(this._castling[e]&Y[S])!==0,[F]:(this._castling[e]&Y[F])!==0}}moveNumber(){return this._moveNumber}}const ge=[{id:1,name:"Pawn Parade",description:"March your pawns forward! But watch out for the Careful Turtle.",fen:"4k3/pppppppp/8/8/8/8/PPPPPPPP/4K3 w - - 0 1",aiPersonality:"random",opponentName:"Careful Turtle",colorClass:"bg-emerald-400",icon:"ðŸ¢"},{id:2,name:"Tower Power",description:"Rooks move fast and straight. Can you beat the Brave Lion?",fen:"r3k2r/pppppppp/8/8/8/8/PPPPPPPP/R3K2R w KQkq - 0 1",aiPersonality:"aggressive",opponentName:"Brave Lion",colorClass:"bg-orange-400",icon:"ðŸ¦"},{id:3,name:"Tricky Knights",description:"Knights jump over other pieces! The Monkey loves to jump around.",fen:"n3k1n1/pppppppp/8/8/8/8/PPPPPPPP/N3K1N1 w - - 0 1",aiPersonality:"random",opponentName:"Tricky Monkey",colorClass:"bg-yellow-400",icon:"ðŸ’"},{id:4,name:"Royal Kingdom",description:"The full army has arrived. Outsmart the Fox to win!",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Clever Fox",colorClass:"bg-indigo-400",icon:"ðŸ¦Š"}],be=[{id:100,name:"Standard Chess",description:"Full game against the computer.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"defensive",opponentName:"Robot",colorClass:"bg-blue-500",icon:"ðŸ¤–",isPvp:!1},{id:101,name:"Player vs Player",description:"Challenge a friend on the same screen.",fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",aiPersonality:"random",opponentName:"Player 2",colorClass:"bg-rose-500",icon:"ðŸ‘¥",isPvp:!0}],K=[...ge,...be],_e={containerBg:"bg-white dark:bg-slate-800",borderColor:"border-slate-200 dark:border-slate-900",gridBg:"bg-slate-100 dark:bg-slate-950",lightSquare:"bg-[#F8FAFC] dark:bg-slate-700",darkSquare:"bg-[#CFE2FF] dark:bg-slate-600",labelLight:"text-slate-400 dark:text-slate-500",labelDark:"text-blue-400/50 dark:text-slate-500",highlight:"bg-indigo-500/20",lastMove:"bg-amber-400/20",check:"bg-rose-500/30",validMoveDot:"bg-indigo-500/30",captureRing:"border-indigo-500/40"},Z={WHITE:{stroke:"#92400E",text:"text-amber-400"},BLACK:{stroke:"#312E81",text:"text-indigo-400"}},J={p:1,n:3,b:3,r:5,q:9,k:0},qe=(d,e)=>{const s=new B(d).moves({verbose:!0});if(s.length===0)return null;if(e==="random"&&Math.random()>.3)return s[Math.floor(Math.random()*s.length)];if(e==="aggressive"){s.sort((n,r)=>{const o=n.captured?J[n.captured]:0;return(r.captured?J[r.captured]:0)-o});const i=s[0];if(i.captured)return i}if(e==="defensive"){const i=s.filter(n=>{const r=new B(d);return r.move(n),!r.moves({verbose:!0}).some(h=>h.to===n.to)});if(i.length>0){i.sort((r,o)=>{const l=r.captured?J[r.captured]:0;return(o.captured?J[o.captured]:0)-l});const n=i.slice(0,3);return n[Math.floor(Math.random()*n.length)]}}return s[Math.floor(Math.random()*s.length)]};let w=null;const ee="chess-kiddo-state-v1",U=d=>{if(typeof window<"u"){const{fen:e,history:t,savedLevelId:s,isPlayerTurn:i,winner:n,isGameOver:r,lastMove:o}=d;if(s){const l={fen:e,history:t,savedLevelId:s,isPlayerTurn:i,winner:n,isGameOver:r,lastMove:o};window.localStorage.setItem(ee,JSON.stringify(l))}}},Oe=()=>{const d={game:new B,fen:new B().fen(),levelId:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Select a level to start!",showFeedback:!1,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[],hasSavedGame:!1,savedLevelId:null};if(typeof window<"u")try{const e=window.localStorage.getItem(ee);if(e){const t=JSON.parse(e);if(t.savedLevelId&&t.fen)return{...d,...t,levelId:null,game:new B(t.fen),hasSavedGame:!t.isGameOver}}}catch(e){console.warn("Failed to load Chess Kiddo state",e)}return d},re=ke((d,e)=>({...Oe(),startLevel:t=>{const s=K.find(r=>r.id===t);if(!s)return;A("start");const i=new B(s.fen),n={game:i,fen:i.fen(),levelId:t,savedLevelId:t,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:s.id>=100?"":s.isPvp?"White's Turn":"Your turn! Tap a white piece.",showFeedback:s.id<100,isPlayerTurn:!0,isGameOver:!1,winner:null,lastMove:null,history:[i.fen()],hasSavedGame:!0};d(n),U(n),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)},resumeGame:()=>{const{savedLevelId:t,fen:s,isGameOver:i}=e();if(!t)return;A("click");const n=new B(s);d({levelId:t,game:n,feedback:i?"Game Over":"Welcome back!",showFeedback:!0}),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),2e3)},selectSquare:t=>{const{game:s,isPlayerTurn:i,isGameOver:n,selectedSquare:r,levelId:o}=e();if(!i||n)return;const l=K.find(m=>m.id===o),h=l==null?void 0:l.isPvp,u=s.turn();if(r===t){d({selectedSquare:null,possibleMoves:[],promotionMoves:[]});return}const p=s.get(t);let c=!1;if(p&&(h?c=p.color===u:c=p.color==="w"&&u==="w"),c){const m=s.moves({square:t,verbose:!0}),f=m.filter(v=>v.promotion).map(v=>v.to);A("click");const g=f.length>0;d({selectedSquare:t,possibleMoves:m.map(v=>v.to),promotionMoves:f,feedback:g?"Promote your pawn!":e().feedback,showFeedback:!!g}),g&&w&&clearTimeout(w)}else r&&e().makeMove(t)},makeMove:t=>{const{game:s,selectedSquare:i,levelId:n}=e();if(!i)return;const r=K.find(h=>h.id===n),o=r==null?void 0:r.isPvp,l=((r==null?void 0:r.id)||0)>=100;try{const u=s.moves({verbose:!0}).find(c=>c.from===i&&c.to===t&&(!c.promotion||c.promotion==="q"));if(!u){d({selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Invalid Move",showFeedback:!0}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),1500);return}const p=s.move(u.san);if(p){p.captured?A("drop"):A("tap");const c=[...e().history,s.fen()];let m="";s.isCheck()?m="Check!":p.promotion?m="Pawn Promoted! ðŸ‘‘":p.captured&&!l?m="Captured!":l||o||(m="Nice move!");const f={fen:s.fen(),selectedSquare:null,possibleMoves:[],promotionMoves:[],lastMove:{from:p.from,to:p.to},history:c,feedback:m,showFeedback:!!m};if(d(f),w&&clearTimeout(w),m&&(w=setTimeout(()=>e().hideFeedback(),2e3)),s.isGameOver()){const g=s.isDraw(),v={isGameOver:!0,winner:g?"draw":"player",feedback:g?"It's a tie!":o?p.color==="w"?"White Wins!":"Black Wins!":"You won!",showFeedback:!0,hasSavedGame:!1};d(v),g||A("win"),typeof window<"u"&&window.localStorage.removeItem(ee)}else o?(d({isPlayerTurn:!0}),U({...e(),...f})):(d({isPlayerTurn:!1}),U({...e(),...f}),setTimeout(()=>e().botMove(),1e3))}}catch(h){console.error(h),d({selectedSquare:null,possibleMoves:[],promotionMoves:[]})}},botMove:()=>{const{game:t,levelId:s}=e();if(t.isGameOver())return;const i=K.find(l=>l.id===s);if(i!=null&&i.isPvp)return;const n=((i==null?void 0:i.id)||0)>=100,r=(i==null?void 0:i.aiPersonality)||"random",o=qe(t.fen(),r);if(o){t.move(o),o.captured?A("drop"):A("tap");const l=[...e().history,t.fen()];let h="";t.isCheck()?h="Watch out! Check!":n||(h=`${(i==null?void 0:i.opponentName)||"Opponent"} moved.`);const u={fen:t.fen(),isPlayerTurn:!0,lastMove:{from:o.from,to:o.to},history:l,feedback:h,showFeedback:!!h};if(d(u),U({...e(),...u}),w&&clearTimeout(w),h&&(w=setTimeout(()=>e().hideFeedback(),2e3)),t.isGameOver()){const p=t.isDraw();d({isGameOver:!0,winner:p?"draw":"bot",feedback:p?"It's a tie!":"Oh no! Try again?",showFeedback:!0,hasSavedGame:!1}),typeof window<"u"&&window.localStorage.removeItem(ee)}}},giveHint:()=>{const{game:t,isPlayerTurn:s,isGameOver:i,levelId:n}=e();if(!s||i)return;const r=K.find(l=>l.id===n);if(((r==null?void 0:r.id)||0)>=100)return;const o=t.moves({verbose:!0});if(o.length>0){const l=o.filter(u=>u.captured||u.promotion),h=l.length>0?l[Math.floor(Math.random()*l.length)]:o[Math.floor(Math.random()*o.length)];d({selectedSquare:h.from,possibleMoves:o.filter(u=>u.from===h.from).map(u=>u.to),promotionMoves:[],feedback:"Try this move!",showFeedback:!0}),A("click"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),3e3)}},hideFeedback:()=>{d({showFeedback:!1})},undo:()=>{const{history:t,levelId:s}=e();if(t.length<=1)return;const i=K.find(u=>u.id===s),n=i!=null&&i.isPvp?1:2;if(t.length<=n){e().startLevel(s);return}const r=t.slice(0,t.length-n),o=r[r.length-1],h={game:new B(o),fen:o,history:r,isPlayerTurn:!0,isGameOver:!1,winner:null,selectedSquare:null,possibleMoves:[],promotionMoves:[],feedback:"Time travel!",showFeedback:((i==null?void 0:i.id)||0)<100};d(h),U({...e(),...h}),A("roll"),w&&clearTimeout(w),w=setTimeout(()=>e().hideFeedback(),2e3)},exitLevel:()=>{d({levelId:null,showFeedback:!1}),w&&clearTimeout(w)}})),he=({level:d,onClick:e})=>a.jsxs("button",{onClick:()=>e(d.id),className:`
        group relative
        flex flex-col items-center text-center
        p-6 rounded-3xl
        bg-white dark:bg-slate-800
        border-2 border-slate-200 dark:border-slate-700
        shadow-xl hover:shadow-2xl hover:-translate-y-1 hover:border-indigo-400
        transition-all duration-300
        h-full
        `,children:[a.jsx("div",{className:`
        w-20 h-20 rounded-full flex items-center justify-center text-5xl mb-4
        ${d.colorClass} text-white shadow-lg group-hover:scale-110 transition-transform
        `,children:d.icon}),a.jsx("h3",{className:"text-2xl font-bold text-slate-800 dark:text-white mb-2",children:d.name}),a.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 leading-relaxed mb-4",children:d.description}),a.jsx("div",{className:"mt-auto",children:a.jsxs("span",{className:"inline-block px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-xs font-bold text-slate-600 dark:text-slate-300 uppercase tracking-wider",children:["VS ",d.opponentName]})})]}),Fe=()=>{const{startLevel:d,hasSavedGame:e,resumeGame:t,savedLevelId:s}=re(),i=s?K.find(n=>n.id===s):null;return a.jsx("div",{className:"w-full h-full overflow-y-auto p-4 md:p-8 animate-fade-in pb-24",children:a.jsxs("div",{className:"max-w-4xl mx-auto space-y-12 text-center",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"inline-block text-6xl mb-2 animate-bounce",children:"â™Ÿï¸"}),a.jsx("h1",{className:"text-4xl md:text-5xl font-black text-slate-900 dark:text-white tracking-tight",children:"Chess Kiddo"}),a.jsx("p",{className:"text-lg text-slate-600 dark:text-slate-400 font-medium",children:"Choose a mode to play!"})]}),e&&i&&a.jsxs("div",{className:"animate-pop",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl p-6 shadow-xl border-l-8 border-indigo-500 flex flex-col sm:flex-row items-center justify-between gap-6 max-w-2xl mx-auto",children:[a.jsxs("div",{className:"text-left",children:[a.jsx("h2",{className:"text-2xl font-black text-slate-900 dark:text-white",children:"Game in Progress"}),a.jsxs("p",{className:"text-slate-500 dark:text-slate-400",children:["Resume: ",a.jsx("span",{className:"font-bold text-indigo-500",children:i.name})]})]}),a.jsx(L,{onClick:t,size:"lg",className:"w-full sm:w-auto !bg-indigo-500 hover:!bg-indigo-400 whitespace-nowrap !rounded-xl !py-4 !px-8 text-lg shadow-lg shadow-indigo-500/30",children:"Continue Game"})]}),a.jsxs("div",{className:"flex items-center gap-4 mt-8 mb-4 max-w-2xl mx-auto",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-slate-400",children:"Or Start New Game"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Quick Play"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:be.map(n=>a.jsx(he,{level:n,onClick:d},n.id))})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"}),a.jsx("h2",{className:"text-xl font-bold uppercase tracking-wider text-slate-400",children:"Learning Missions"}),a.jsx("div",{className:"h-px bg-slate-200 dark:bg-slate-700 flex-1"})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:ge.map(n=>a.jsx(he,{level:n,onClick:d},n.id))})]})]})})},Ke={p:"â™Ÿï¸Ž",n:"â™žï¸Ž",b:"â™ï¸Ž",r:"â™œï¸Ž",q:"â™›ï¸Ž",k:"â™šï¸Ž"},Be=W.memo(({type:d,color:e})=>{const t=Ke[d],i=e==="w"?Z.WHITE:Z.BLACK,n=i.stroke,r=`
    0.02em 0.02em 0 ${n},
    -0.02em -0.02em 0 ${n},
    0.02em -0.02em 0 ${n},
    -0.02em 0.02em 0 ${n},
    0 0.04em 0.1em rgba(0,0,0,0.2)
  `;return a.jsx("div",{className:"relative w-full h-full flex items-center justify-center pointer-events-none select-none overflow-visible",children:a.jsx("div",{className:`
            leading-none 
            transition-transform duration-200
            ${i.text}
            pb-[10%]
            will-change-transform
            flex items-center justify-center
        `,style:{fontFamily:'"Apple Symbols", "Segoe UI Symbol", "DejaVu Sans", sans-serif',fontSize:"75cqmin",textShadow:r,filter:"drop-shadow(0 4px 4px rgba(0,0,0,0.1))"},children:a.jsx("span",{children:t})})})}),De=W.memo(({square:d,piece:e,bgClass:t,labelColorClass:s,isSelected:i,isPossibleMove:n,isPromotionMove:r,isLastMove:o,isCheck:l,onClick:h})=>{const u=_e;return a.jsx("div",{onClick:h,className:"relative w-full h-full p-0.5 md:p-1",style:{containerType:"size"},children:a.jsxs("div",{className:`
                relative w-full h-full flex items-center justify-center
                rounded-md md:rounded-lg
                ${t}
                ${n||r?"cursor-pointer":""}
                transition-all duration-200
                shadow-sm
                border-b-2 border-black/5 dark:border-white/5
            `,children:[i&&a.jsx("div",{className:`absolute inset-0 ${u.highlight} z-0 rounded-md md:rounded-lg ring-inset ring-4 ring-indigo-500/50`}),o&&!i&&a.jsx("div",{className:`absolute inset-0 ${u.lastMove} z-0 rounded-md md:rounded-lg`}),l&&a.jsx("div",{className:`absolute inset-0 ${u.check} z-0 animate-pulse rounded-md md:rounded-lg ring-inset ring-4 ring-rose-500/50`}),(d.includes("1")||d.includes("a"))&&a.jsx("span",{className:`absolute bottom-0.5 left-1 text-[7px] md:text-[9px] font-black select-none z-0 ${s} opacity-80`,children:d.toUpperCase()}),n&&!e&&!r&&a.jsx("div",{className:`absolute w-[20%] h-[20%] ${u.validMoveDot} rounded-full z-10 border border-indigo-500/20`}),n&&e&&!r&&a.jsx("div",{className:`absolute inset-[8%] border-4 border-dashed ${u.captureRing} rounded-full z-10 animate-spin-slow`,style:{animationDuration:"10s"}}),e&&a.jsx("div",{className:"relative z-10 w-full h-full flex items-center justify-center transform transition-transform group-active:scale-90",children:a.jsx(Be,{type:e.type,color:e.color})})]})})}),$e=()=>{const{game:d,fen:e,selectedSquare:t,possibleMoves:s,promotionMoves:i,lastMove:n,selectSquare:r}=re(),{enableTilt:o}=me(),l=_e,h=W.useMemo(()=>d.board(),[e,d]),u=["a","b","c","d","e","f","g","h"],p=[8,7,6,5,4,3,2,1],c=W.useMemo(()=>({width:"100%",maxWidth:"100%",aspectRatio:"1/1",transform:o?"rotateX(5deg)":"none"}),[o]);return a.jsx("div",{className:"relative w-full h-full flex items-center justify-center perspective-1000 p-2 md:p-6",children:a.jsx("div",{className:`
            relative
            w-full h-full
            rounded-2xl md:rounded-[2rem]
            p-2 md:p-3
            border-2
            transition-all duration-500 ease-out
            will-change-transform
            ${l.containerBg}
            ${l.borderColor}
            shadow-[0_10px_30px_rgba(0,0,0,0.15),_0_8px_0_#cbd5e1]
            dark:shadow-[0_10px_40px_rgba(0,0,0,0.5),_0_8px_0_#0f172a]
          `,style:c,children:a.jsx("div",{className:`
            relative
            w-full h-full
            ${l.gridBg}
            rounded-xl md:rounded-[1.5rem]
            overflow-hidden
            shadow-[inset_0_4px_12px_rgba(0,0,0,0.15)]
            border-4 border-slate-200 dark:border-slate-900
          `,children:a.jsx("div",{className:`
               w-full h-full 
               grid grid-cols-8 grid-rows-8 
               p-0.5 md:p-1
             `,children:h.map((m,f)=>m.map((g,v)=>{const k=`${u[v]}${p[f]}`,I=(f+v)%2===0,_=t===k,y=s.includes(k),j=i==null?void 0:i.includes(k),R=n?n.from===k||n.to===k:!1,$=(g==null?void 0:g.type)==="k"&&(g==null?void 0:g.color)===d.turn()&&d.isCheck(),G=I?l.lightSquare:l.darkSquare,V=I?l.labelLight:l.labelDark;return a.jsx(De,{square:k,piece:g,bgClass:G,labelColorClass:V,isSelected:_,isPossibleMove:y,isPromotionMove:j,isLastMove:R,isCheck:$,onClick:()=>r(k)},k)}))})})})})},fe=W.memo(({name:d,isWhite:e,isActive:t,alignment:s})=>{const i=s==="right",n=e?Z.WHITE:Z.BLACK;return a.jsxs("div",{className:`
        flex items-center gap-2 md:gap-4 transition-all duration-500
        ${t?"opacity-100 scale-100":"opacity-60 scale-95 grayscale-[0.3]"}
        ${i?"flex-row-reverse text-right":"flex-row text-left"}
    `,children:[a.jsxs("div",{className:`
          relative w-10 h-10 md:w-14 md:h-14 rounded-xl md:rounded-2xl flex items-center justify-center text-2xl md:text-4xl shadow-lg border-2
          ${e?"bg-white border-amber-400":"bg-white border-indigo-400"}
          ${t?"ring-2 ring-indigo-500/20 ring-offset-2 dark:ring-offset-slate-950":""}
          transition-all duration-300
       `,children:[a.jsx("span",{className:`${n.text} drop-shadow-sm font-black transform ${t?"scale-110":"scale-100"}`,style:{textShadow:`1px 1px 0 ${n.stroke}`,filter:"drop-shadow(0 1px 1px rgba(0,0,0,0.1))"},children:e?"â™”":"â™š"}),t&&a.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-emerald-500 border-2 border-white dark:border-slate-800 rounded-full animate-ping"})]}),a.jsxs("div",{className:"flex flex-col justify-center min-w-0 max-w-[100px] md:max-w-[140px]",children:[a.jsx("span",{className:"font-bold text-slate-900 dark:text-white text-xs md:text-lg tracking-tight leading-none truncate",children:d}),a.jsx("div",{className:"flex items-center gap-1 mt-1",children:a.jsx("span",{className:`
                text-[9px] md:text-[10px] font-black uppercase tracking-wider px-1.5 py-0.5 rounded-full
                ${t?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300 animate-pulse":"bg-slate-200 text-slate-500 dark:bg-slate-800 dark:text-slate-500"}
            `,children:t?"Turn":"Wait"})})]})]})}),ue=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),Ge=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),Qe=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 15L3 9m0 0l6-6M3 9h12a6 6 0 010 12h-3"})}),Ue=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18"})}),He=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),Ve=()=>{const{setView:d,players:e}=me(),{levelId:t,game:s,feedback:i,showFeedback:n,history:r,undo:o,giveHint:l,exitLevel:h,startLevel:u,isGameOver:p,winner:c}=re(),m=K.find($=>$.id===t),f=((m==null?void 0:m.id)||0)>=100,g=m==null?void 0:m.isPvp,v=!f&&!p,k=g?e[ae.ONE].name:"You",I=g?e[ae.TWO].name:(m==null?void 0:m.opponentName)||"Opponent",_=s.turn(),y=()=>{h(),d(we.HOME)},j=()=>{h()},R=()=>{t&&u(t)};return!t||!m?a.jsxs("div",{className:"flex flex-col h-screen w-full bg-slate-100 dark:bg-slate-900 relative",children:[a.jsx("header",{className:"shrink-0 h-16 md:h-20 px-4 md:px-8 flex items-center justify-center z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md sticky top-0",children:a.jsx(L,{variant:"icon",size:"sm",onClick:y,title:"Return to Menu",children:a.jsx(ue,{})})}),a.jsx(Fe,{})]}):a.jsxs("div",{className:"flex flex-col h-screen w-full bg-slate-100 dark:bg-slate-950 transition-colors duration-500 overflow-hidden relative",children:[a.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[a.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-blue-400/5 rounded-full blur-[80px]"}),a.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-400/5 rounded-full blur-[80px]"})]}),a.jsxs("header",{className:"shrink-0 h-16 md:h-20 px-3 md:px-8 flex items-center justify-between z-30 bg-white/60 dark:bg-slate-900/40 backdrop-blur-md border-b border-slate-200 dark:border-white/5 relative shadow-sm transition-colors duration-300",children:[a.jsx("div",{className:"flex-1 flex justify-start min-w-0",children:a.jsx(fe,{name:k,isWhite:!0,isActive:_==="w"&&!p,alignment:"left"})}),a.jsxs("div",{className:"shrink-0 flex items-center gap-1 md:gap-2 mx-2",children:[a.jsx(L,{variant:"icon",size:"sm",onClick:j,title:"Level Select",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(Ge,{})}),a.jsx(L,{variant:"icon",size:"sm",onClick:R,title:"Restart",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(He,{})}),v&&a.jsx(L,{variant:"icon",size:"sm",onClick:l,title:"Get a Hint",className:"w-9 h-9 md:w-11 md:h-11 p-2 !bg-indigo-50 !text-indigo-600 dark:!bg-indigo-900/30 dark:!text-indigo-300 border-indigo-100 dark:border-indigo-800 shadow-inner",children:a.jsx(Ue,{})}),a.jsx(L,{variant:"icon",size:"sm",onClick:o,disabled:r.length<=1||p,title:"Undo Move",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(Qe,{})}),a.jsx(L,{variant:"icon",size:"sm",onClick:y,title:"Home",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:a.jsx(ue,{})})]}),a.jsx("div",{className:"flex-1 flex justify-end min-w-0",children:a.jsx(fe,{name:I,isWhite:!1,isActive:_==="b"&&!p,alignment:"right"})})]}),a.jsxs("main",{className:"flex-1 w-full h-full flex flex-col items-center justify-center p-2 relative z-10 perspective-1000 overflow-hidden",children:[a.jsxs("div",{className:"relative aspect-square portrait:w-full portrait:max-h-full landscape:h-full landscape:max-w-full flex items-center justify-center animate-fade-in",children:[a.jsx($e,{}),n&&i&&a.jsx("div",{className:"absolute top-4 pointer-events-none transition-all duration-300 transform z-20",children:a.jsxs("div",{className:"bg-white/95 dark:bg-slate-800/95 rounded-2xl px-6 py-2 shadow-xl border-b-4 border-indigo-500 flex items-center gap-3 animate-bounce-in",children:[a.jsx("span",{className:"text-2xl",children:m.icon}),a.jsx("p",{className:"text-slate-900 dark:text-white font-black text-sm md:text-lg tracking-tight uppercase",children:i})]})})]}),p&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm animate-fade-in",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-8 md:p-12 rounded-[3rem] text-center shadow-2xl max-w-md w-full border-b-8 border-indigo-500",children:[a.jsx("div",{className:"w-24 h-24 mx-auto rounded-3xl bg-indigo-50 dark:bg-indigo-900/30 flex items-center justify-center text-6xl mb-8 shadow-inner rotate-3",children:c==="player"?"ðŸ‘‘":c==="draw"?"ðŸ¤":"ðŸ’«"}),a.jsx("h2",{className:"text-4xl font-black text-slate-900 dark:text-white mb-4 tracking-tight",children:c==="player"?g?s.turn()==="b"?"White Wins!":"Black Wins!":"Victory!":c==="draw"?"Match Draw":"Nice Effort!"}),a.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-10 font-bold text-lg leading-relaxed",children:c==="player"?"You played like a champion!":"That was a close one. Ready to try again?"}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsx(L,{onClick:R,size:"lg",className:"w-full !rounded-2xl !py-5 !text-2xl shadow-xl shadow-indigo-500/30",children:"Play Again"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsx(L,{onClick:j,variant:"secondary",className:"w-full !rounded-2xl !py-4 font-bold !bg-slate-100 dark:!bg-slate-700 text-slate-600 dark:text-slate-300 border-none",children:"Levels"}),a.jsx(L,{onClick:y,variant:"secondary",className:"w-full !rounded-2xl !py-4 font-bold !bg-slate-100 dark:!bg-slate-700 text-slate-600 dark:text-slate-300 border-none",children:"Home"})]})]})]})})]})]})};export{Ve as ChessKiddoGame};
