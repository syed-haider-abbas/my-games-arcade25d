import{c as $,p as y,r as b,j as e,u as A,B as N,V as Y}from"./index-DTA46di8.js";var x=(t=>(t.IDLE="IDLE",t.PLAYING="PLAYING",t.GAME_OVER="GAME_OVER",t))(x||{});const P=6,I={2:{bg:"bg-slate-200 dark:bg-slate-100",text:"text-slate-700",shadow:"shadow-slate-300 dark:shadow-slate-400"},4:{bg:"bg-amber-100 dark:bg-amber-100",text:"text-slate-800",shadow:"shadow-amber-200 dark:shadow-amber-300"},8:{bg:"bg-orange-300",text:"text-white",shadow:"shadow-orange-400"},16:{bg:"bg-orange-500",text:"text-white",shadow:"shadow-orange-600"},32:{bg:"bg-rose-500",text:"text-white",shadow:"shadow-rose-600"},64:{bg:"bg-rose-700",text:"text-white",shadow:"shadow-rose-800"},128:{bg:"bg-yellow-400",text:"text-white",shadow:"shadow-yellow-500"},256:{bg:"bg-yellow-500",text:"text-white shadow-yellow-500/50",shadow:"shadow-yellow-600"},512:{bg:"bg-yellow-600",text:"text-white shadow-yellow-600/50",shadow:"shadow-yellow-700"},1024:{bg:"bg-emerald-500",text:"text-white shadow-emerald-500/50",shadow:"shadow-emerald-600"},2048:{bg:"bg-emerald-600",text:"text-white shadow-emerald-600/50",shadow:"shadow-emerald-700"},4096:{bg:"bg-slate-900",text:"text-white",shadow:"shadow-black"}},O={bg:"bg-slate-800",text:"text-white",shadow:"shadow-slate-900"},B=()=>Math.random().toString(36).substr(2,9),V=(t,s)=>{const l=[],a=new Set(t.map(o=>`${o.row}-${o.col}`));for(let o=0;o<s;o++)for(let d=0;d<s;d++)a.has(`${o}-${d}`)||l.push({r:o,c:d});return l},M=(t,s)=>{const l=V(t,s);if(l.length===0)return t;const{r:a,c:o}=l[Math.floor(Math.random()*l.length)],d={id:B(),value:Math.random()<.9?2:4,row:a,col:o,isNew:!0};return[...t,d]},U=t=>{let s=[];return s=M(s,t),s=M(s,t),s},F=(t,s)=>{if(t.length<s*s)return!0;const l=Array(s).fill(null).map(()=>Array(s).fill(0));t.forEach(a=>l[a.row][a.col]=a.value);for(let a=0;a<s;a++)for(let o=0;o<s;o++){const d=l[a][o];if(o<s-1&&l[a][o+1]===d||a<s-1&&l[a+1][o]===d)return!0}return!1},H=(t,s,l)=>{let a={x:0,y:0};s==="UP"&&(a={x:0,y:-1}),s==="DOWN"&&(a={x:0,y:1}),s==="LEFT"&&(a={x:-1,y:0}),s==="RIGHT"&&(a={x:1,y:0});let o=t.map(n=>({...n,isNew:!1,isMerged:!1})),d=!1,c=0;s==="RIGHT"&&o.sort((n,m)=>m.col-n.col),s==="LEFT"&&o.sort((n,m)=>n.col-m.col),s==="DOWN"&&o.sort((n,m)=>m.row-n.row),s==="UP"&&o.sort((n,m)=>n.row-m.row);const u=[],g=new Set,h=Array(l).fill(null).map(()=>Array(l).fill(null));return o.forEach(n=>{let m=n.row,v=n.col,w=m,i=v;for(;;){const f=w+a.y,p=i+a.x;if(f<0||f>=l||p<0||p>=l)break;const r=h[f][p];if(r){r.value===n.value&&!g.has(`${f}-${p}`)&&(w=f,i=p);break}w=f,i=p}(w!==m||i!==v)&&(d=!0);const _=h[w][i];if(_&&_.value===n.value&&!g.has(`${w}-${i}`)){const f=u.findIndex(j=>j.id===_.id);f!==-1&&u.splice(f,1);const p=n.value*2;c+=p;const r={...n,value:p,row:w,col:i,isMerged:!0};u.push(r),h[w][i]=r,g.add(`${w}-${i}`)}else{const f={...n,row:w,col:i};u.push(f),h[w][i]=f}}),{tiles:u,score:c,changed:d}},R="2048-state-v1",C="2048-best-score",D=t=>{if(typeof window<"u"){const{tiles:s,score:l,status:a,gridSize:o}=t;window.localStorage.setItem(R,JSON.stringify({tiles:s,score:l,status:a,gridSize:o})),window.localStorage.setItem(C,(t.bestScore||0).toString())}},W=()=>typeof window<"u"?parseInt(localStorage.getItem(C)||"0",10):0,X=()=>{const t={tiles:[],score:0,bestScore:W(),status:x.IDLE,gridSize:P,isMoving:!1,hasSavedGame:!1};if(typeof window<"u")try{const s=window.localStorage.getItem(R);if(s){const l=JSON.parse(s);if(l.status===x.PLAYING)return{...t,...l,status:x.IDLE,hasSavedGame:!0}}}catch(s){console.warn("Failed to load 2048 state",s)}return t},S=(t,s,l)=>{const{tiles:a,score:o,status:d,bestScore:c,gridSize:u,isMoving:g}=l();if(d!==x.PLAYING||g)return;const h=H(a,t,u);if(h.changed){y("tap");const n=o+h.score,m=Math.max(n,c);s({tiles:h.tiles,score:n,bestScore:m,isMoving:!0}),setTimeout(()=>{const v=l(),w=M(v.tiles,u),i=!F(w,u);i&&y("drop");const _=i?x.GAME_OVER:x.PLAYING,f={tiles:w,status:_,isMoving:!1,hasSavedGame:_===x.PLAYING};s(f),D({...v,...f})},150)}},k=$((t,s)=>({...X(),startGame:l=>{y("start");const a={tiles:U(l),score:0,status:x.PLAYING,gridSize:l,isMoving:!1,hasSavedGame:!1};t(a),D({...s(),...a})},resumeGame:()=>{y("click"),t({status:x.PLAYING})},resetGame:()=>{y("click"),t({status:x.IDLE,isMoving:!1,hasSavedGame:s().status===x.PLAYING})},moveUp:()=>S("UP",t,s),moveDown:()=>S("DOWN",t,s),moveLeft:()=>S("LEFT",t,s),moveRight:()=>S("RIGHT",t,s)})),z=b.memo(({value:t,row:s,col:l,gridSize:a,isNew:o,isMerged:d})=>{const c=b.useMemo(()=>I[t]||(t>2048?I[4096]:O),[t]),u=b.useMemo(()=>a>=8?t>999?"text-xs md:text-sm":t>99?"text-sm md:text-base":"text-base md:text-xl":a>=6?t>999?"text-sm md:text-xl":t>99?"text-xl md:text-2xl":"text-2xl md:text-3xl":t>999?"text-2xl md:text-3xl":t>99?"text-3xl md:text-4xl":"text-4xl md:text-5xl",[t,a]),g=b.useMemo(()=>{const n=100/a;return{top:`${s*n}%`,left:`${l*n}%`,width:`${n}%`,height:`${n}%`}},[s,l,a]),h=b.useMemo(()=>t<=4?"0 1px 0 rgba(255,255,255,0.6)":"0 -1px 0 rgba(0,0,0,0.2)",[t]);return e.jsx("div",{className:"absolute p-1 md:p-1.5 z-10 will-change-transform",style:{...g,transform:"translate3d(0, 0, 0)",transition:"top 150ms ease-out, left 150ms ease-out"},children:e.jsxs("div",{className:`
                    relative
                    w-full h-full 
                    rounded-md md:rounded-lg
                    flex items-center justify-center 
                    ${c.bg} ${c.text}
                    
                    /* Inward Depth / Block Bevel - No external drop shadow */
                    shadow-[inset_0_2px_0_rgba(255,255,255,0.4),_inset_0_-3px_0_rgba(0,0,0,0.2)]
                    border border-black/5
                    
                    ${o?"animate-pop":""}
                    ${d?"animate-bounce-in":""}
                `,children:[e.jsx("div",{className:"absolute inset-0 rounded-md md:rounded-lg bg-gradient-to-br from-white/20 to-transparent pointer-events-none"}),e.jsx("span",{className:`
                        font-black tracking-tight ${u} select-none relative z-20
                        drop-shadow-[0_1px_1px_rgba(0,0,0,0.1)]
                    `,style:{textShadow:h},children:t})]})})},(t,s)=>t.value===s.value&&t.row===s.row&&t.col===s.col&&t.gridSize===s.gridSize&&t.isNew===s.isNew&&t.isMerged===s.isMerged),K=b.memo(()=>e.jsx("div",{className:"w-full h-full p-1 md:p-1.5",children:e.jsx("div",{className:"w-full h-full rounded-md md:rounded-lg bg-[#b6c6d8] dark:bg-[#0f172a] shadow-[inset_0_3px_6px_rgba(0,0,0,0.25),_inset_0_-1px_0_rgba(255,255,255,0.2)] dark:shadow-[inset_0_4px_8px_rgba(0,0,0,0.8),_inset_0_-1px_0_rgba(255,255,255,0.05)] border border-black/5 dark:border-white/5"})})),q=b.memo(()=>{const t=k(r=>r.tiles),s=k(r=>r.moveUp),l=k(r=>r.moveDown),a=k(r=>r.moveLeft),o=k(r=>r.moveRight),d=k(r=>r.status),c=k(r=>r.gridSize),u=A(r=>r.enableTilt),g=b.useRef(null),h=b.useRef(!1),n=30,m=b.useCallback(r=>{if(d===x.PLAYING)switch(r.key){case"ArrowUp":r.preventDefault(),s();break;case"ArrowDown":r.preventDefault(),l();break;case"ArrowLeft":r.preventDefault(),a();break;case"ArrowRight":r.preventDefault(),o();break}},[d,s,l,a,o]);b.useEffect(()=>(window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)),[m]);const v=b.useCallback(r=>{g.current={x:r.touches[0].clientX,y:r.touches[0].clientY},h.current=!0},[]),w=b.useCallback(r=>{h.current&&r.preventDefault()},[]),i=b.useCallback(r=>{if(!g.current||d!==x.PLAYING){g.current=null,h.current=!1;return}const j=r.changedTouches[0].clientX-g.current.x,L=r.changedTouches[0].clientY-g.current.y,E=Math.abs(j),G=Math.abs(L);(E>n||G>n)&&(E>G?j>0?o():a():L>0?l():s()),g.current=null,h.current=!1},[d,s,l,a,o]),_=b.useMemo(()=>Array.from({length:c*c},(r,j)=>e.jsx(K,{},j)),[c]),f=b.useMemo(()=>({width:"100%",maxWidth:"100%",aspectRatio:"1/1",transform:u?"rotateX(10deg)":"none"}),[u]),p=b.useMemo(()=>({gridTemplateColumns:`repeat(${c}, minmax(0, 1fr))`,gridTemplateRows:`repeat(${c}, minmax(0, 1fr))`}),[c]);return e.jsx("div",{className:"relative w-full h-full flex items-center justify-center p-4 perspective-1000",children:e.jsxs("div",{className:`
                    relative 
                    bg-[#94a3b8] dark:bg-[#1e293b] 
                    rounded-xl md:rounded-2xl
                    shadow-[0_20px_50px_rgba(0,0,0,0.3),_0_10px_0_#64748b] dark:shadow-[0_30px_60px_-10px_rgba(0,0,0,0.6),_0_10px_0_#0f172a]
                    border-b-8 border-r-8 border-[#64748b] dark:border-[#0f172a]
                    perspective-1000
                    touch-none select-none
                    will-change-transform
                `,style:f,onTouchStart:v,onTouchMove:w,onTouchEnd:i,children:[e.jsx("div",{className:`
                        absolute inset-0 
                        grid
                        gap-0
                        p-2
                        bg-[#cbd5e1] dark:bg-[#334155]
                        rounded-lg md:rounded-xl
                        shadow-[inset_0_2px_15px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_2px_15px_rgba(0,0,0,0.4)]
                        border-4 border-[#94a3b8] dark:border-[#1e293b]
                    `,style:p,children:_}),e.jsx("div",{className:"absolute inset-3 pointer-events-none",children:t.map(r=>e.jsx(z,{...r,gridSize:c},r.id))}),d===x.GAME_OVER&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-slate-900/60 backdrop-blur-sm rounded-xl animate-fade-in p-4 text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-black text-white mb-2 drop-shadow-lg",children:"Game Over"}),e.jsx("p",{className:"text-white/80 font-bold text-lg mb-6",children:"No more moves!"})]})]})})}),T=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),J=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"})}),Z=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-4 h-4 md:w-5 md:h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"})}),ee=()=>{const{status:t,score:s,bestScore:l,startGame:a,resumeGame:o,resetGame:d,gridSize:c,hasSavedGame:u}=k(),{setView:g}=A(),[h,n]=b.useState(c||6),m=()=>{d(),g(Y.HOME)},v=()=>{d()},w=()=>{a(c)};return e.jsxs("div",{className:"flex flex-col h-screen w-full bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-white relative overflow-hidden transition-colors duration-500",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none opacity-40",children:[e.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top_right,_#fcd34d_0%,_#f1f5f9_50%)] dark:bg-[radial-gradient(circle_at_top_right,_#d97706_0%,_#0f172a_50%)]"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1/2 bg-[radial-gradient(ellipse_at_bottom_left,_#fde68a_0%,_transparent_50%)] dark:bg-[radial-gradient(ellipse_at_bottom_left,_#92400e_0%,_transparent_50%)]"})]}),e.jsxs("header",{className:"shrink-0 h-16 md:h-20 px-3 md:px-8 flex items-center justify-between z-30 bg-white/60 dark:bg-black/20 backdrop-blur-md border-b border-slate-200 dark:border-white/5 shadow-sm transition-colors duration-300",children:[e.jsx("div",{className:"flex-1 flex justify-start min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 flex-row text-left",children:[e.jsx("div",{className:"relative w-10 h-10 md:w-14 md:h-14 rounded-xl md:rounded-2xl flex items-center justify-center bg-gradient-to-br from-slate-700 to-black shadow-lg shadow-slate-900/50 border-2 border-slate-600",children:e.jsx("span",{className:"text-lg md:text-2xl font-black text-white",children:"#"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h2",{className:"text-sm md:text-lg font-bold text-slate-700 dark:text-white leading-tight",children:"Score"}),e.jsx("div",{className:"px-2 py-0.5 mt-0.5 rounded-md bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-900 dark:text-white text-[10px] md:text-xs font-mono font-bold w-fit",children:s})]})]})}),e.jsx("div",{className:"shrink-0 flex gap-2 mx-2",children:t===x.PLAYING||t===x.GAME_OVER?e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"icon",size:"sm",onClick:v,title:"Back to Menu",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:e.jsx(J,{})}),e.jsx(N,{variant:"icon",size:"sm",onClick:w,title:"Restart Game",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:e.jsx(Z,{})}),e.jsx(N,{variant:"icon",size:"sm",onClick:m,title:"Return to Menu",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:e.jsx(T,{})})]}):e.jsx(N,{variant:"icon",size:"sm",onClick:m,title:"Return to Menu",className:"w-9 h-9 md:w-11 md:h-11 p-2",children:e.jsx(T,{})})}),e.jsx("div",{className:"flex-1 flex justify-end min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3 md:gap-4 flex-row-reverse text-right",children:[e.jsx("div",{className:"relative w-10 h-10 md:w-14 md:h-14 rounded-xl md:rounded-2xl flex items-center justify-center bg-gradient-to-br from-amber-400 to-amber-600 shadow-lg shadow-amber-500/50 border-2 border-amber-300",children:e.jsx("span",{className:"text-lg md:text-2xl font-black text-white",children:"ðŸ†"})}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h2",{className:"text-sm md:text-lg font-bold text-slate-700 dark:text-white leading-tight",children:"Best"}),e.jsx("div",{className:"px-2 py-0.5 mt-0.5 rounded-md bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-900 dark:text-white text-[10px] md:text-xs font-mono font-bold self-end",children:l})]})]})})]}),e.jsxs("main",{className:"flex-1 h-screen w-screen flex items-center justify-center p-2 pb-20 relative z-10 perspective-1000",children:[e.jsx("div",{className:`
                    relative aspect-square 
                    portrait:w-full portrait:max-h-full
                    landscape:h-full landscape:max-w-full
                    flex items-center justify-center
                `,children:t===x.IDLE?e.jsxs("div",{className:"w-full h-full max-w-md max-h-md aspect-square bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl p-8 shadow-2xl border border-white dark:border-slate-700 text-center animate-bounce-in",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-amber-500 rounded-2xl flex items-center justify-center text-4xl font-black text-white shadow-xl shadow-amber-500/40 mb-6 rotate-3",children:"2048"}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white mb-2",children:"Ready?"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-6",children:"Choose your grid size and merge the numbers!"}),u&&e.jsxs("div",{className:"mb-8",children:[e.jsxs(N,{onClick:o,size:"lg",className:"w-full !bg-amber-600 hover:!bg-amber-500 !shadow-amber-700",children:["Continue Game (",c,"x",c,")"]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx("div",{className:"h-px w-full bg-slate-300 dark:bg-slate-600"}),e.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase whitespace-nowrap",children:"Or Start New"}),e.jsx("div",{className:"h-px w-full bg-slate-300 dark:bg-slate-600"})]})]}),e.jsx("div",{className:"flex justify-center gap-3 mb-8",children:[4,6,8].map(i=>e.jsxs("button",{onClick:()=>n(i),className:`
                                            w-12 h-12 rounded-xl font-bold text-lg transition-all
                                            ${h===i?"bg-amber-500 text-white shadow-lg shadow-amber-500/50 scale-110":"bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600"}
                                        `,children:[i,"x",i]},i))}),e.jsx(N,{onClick:()=>a(h),size:"lg",className:"w-full !bg-amber-500 hover:!bg-amber-400 !shadow-amber-600",variant:u?"secondary":"primary",children:"Start New Game"})]}):e.jsx("div",{className:"w-full h-screen flex items-center justify-center animate-fade-in",children:e.jsx(q,{})})}),t===x.PLAYING&&e.jsx("div",{className:"mt-6 text-slate-400 text-sm font-medium animate-pulse hidden md:block absolute bottom-4",children:"Use Arrow Keys to move â€¢ Merge identical tiles"})]})]})};export{ee as Game2048};
